<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-UK" xml:lang="en-UK" >

<head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />     <meta name="author" content="Fidel Oltra, Ricardo Sánchez" />        <title>Unit 04. Form validation. Guided example.</title>
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        div.columns{display: flex; gap: min(4vw, 1.5em);}
        div.column{flex: auto; overflow-x: auto;}
        div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
        /* The extra [class] is a hack that increases specificity enough to
           override a similar rule in reveal.js */
        ul.task-list[class]{list-style: none;}
        ul.task-list li input[type="checkbox"] {
          font-size: inherit;
          width: 0.8em;
          margin: 0 0.8em 0.2em -1.6em;
          vertical-align: middle;
        }
        .display.math{display: block; text-align: center; margin: 0.5rem auto;}
        /* CSS for syntax highlighting */
        pre > code.sourceCode { white-space: pre; position: relative; }
        pre > code.sourceCode > span { line-height: 1.25; }
        pre > code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        pre > code.sourceCode { white-space: pre-wrap; }
        pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {  background-color: #f8f8f8; }
        @media screen {
        pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ef2929; } /* Alert */
        code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
        code span.at { color: #204a87; } /* Attribute */
        code span.bn { color: #0000cf; } /* BaseN */
        code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
        code span.ch { color: #4e9a06; } /* Char */
        code span.cn { color: #8f5902; } /* Constant */
        code span.co { color: #8f5902; font-style: italic; } /* Comment */
        code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
        code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
        code span.dt { color: #204a87; } /* DataType */
        code span.dv { color: #0000cf; } /* DecVal */
        code span.er { color: #a40000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.fl { color: #0000cf; } /* Float */
        code span.fu { color: #204a87; font-weight: bold; } /* Function */
        code span.im { } /* Import */
        code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
        code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
        code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
        code span.ot { color: #8f5902; } /* Other */
        code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
        code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
        code span.ss { color: #4e9a06; } /* SpecialString */
        code span.st { color: #4e9a06; } /* String */
        code span.va { color: #000000; } /* Variable */
        code span.vs { color: #4e9a06; } /* VerbatimString */
        code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
        <link rel="stylesheet" href="../web_template/aqua.css" />  
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
      
</head>

<body>
    <div id="content">
                 <header id="title-block-header">
            <h1 class="title">Unit 04. Form validation. Guided
example.</h1>
            <!---->
            <!--         <p class="author">Fidel Oltra, Ricardo
Sánchez</p>
         -->
                    </header>
                 <nav id="TOC" role="doc-toc">
            <div class="navContainer">
                                <h2 id="toc-title">Index</h2>
                 <ul>
<li><a href="#php-form-validation" id="toc-php-form-validation"><span
class="toc-section-number">1</span> PHP Form validation</a>
<ul>
<li><a href="#form-action" id="toc-form-action"><span
class="toc-section-number">1.1</span> Form action</a></li>
<li><a href="#validate-form-data" id="toc-validate-form-data"><span
class="toc-section-number">1.2</span> Validate form data</a></li>
<li><a href="#required-fields" id="toc-required-fields"><span
class="toc-section-number">1.3</span> Required fields</a></li>
<li><a href="#display-the-error-messages"
id="toc-display-the-error-messages"><span
class="toc-section-number">1.4</span> Display the error
messages</a></li>
<li><a href="#validate-inputs" id="toc-validate-inputs"><span
class="toc-section-number">1.5</span> Validate inputs</a></li>
<li><a href="#keep-the-values-in-the-form"
id="toc-keep-the-values-in-the-form"><span
class="toc-section-number">1.6</span> Keep the values in the
form</a></li>
<li><a href="#send-the-data-to-another-script"
id="toc-send-the-data-to-another-script"><span
class="toc-section-number">1.7</span> Send the data to another
script</a></li>
</ul></li>
</ul>
            </div>
        </nav>
                <main>
            <p>In this example we’re going to show how to validate a
            simple form, using auto-validation techniques.</p>
            <blockquote>
            <p><strong>Security is important!</strong>: This guide will
            show how to process PHP forms with security in mind. Proper
            validation of form data is important to protect your form
            from hackers and spammers!</p>
            </blockquote>
            <h1 data-number="1" id="php-form-validation"><span
            class="header-section-number">1</span> PHP Form
            validation</h1>
            <p>We are going to do a form to enter providers data. So the
            data needed are: name, email and CIF.</p>
            <p>The HTML form we will be working at contains 3 input
            fields: name, email and CIF, and a submit button:</p>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">form</span><span class="ot"> action</span><span class="op">=</span><span class="st">&quot;&quot;</span><span class="ot"> method</span><span class="op">=</span><span class="st">&quot;POST&quot;</span><span class="dt">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;name&quot;</span><span class="dt">&gt;</span>Name:<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;name&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;name&quot;</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="dt">&gt;</span>Email:<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;cif&quot;</span><span class="dt">&gt;</span>CIF:<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;cif&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;cif&quot;</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;submit&quot;</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value</span><span class="op">=</span><span class="st">&quot;Submit&quot;</span><span class="dt">&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">form</span><span class="dt">&gt;</span></span></code></pre></div>
            <p><img src="images/form1.png" /></p>
            <blockquote>
            <p>Note that we are using <code>type="text"</code> instead
            of <code>"email"</code> for the email field. That will
            ensure that the validation will be done in the PHP code.</p>
            </blockquote>
            <p>We will follow the next validation rules:</p>
            <ul>
            <li><p><strong>Name</strong>: Required and must have at
            least 4 characters.</p></li>
            <li><p><strong>Email</strong>: Required and must contain a
            valid email address (with @ and .)</p></li>
            <li><p><strong>CIF</strong>: Required and must be a string
            starting with a letter and 8 digits, ex. C12345678.</p></li>
            </ul>
            <h2 data-number="1.1" id="form-action"><span
            class="header-section-number">1.1</span> Form action</h2>
            <p>As we want the form to be auto-validated, we have to send
            the data to itself:</p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>form action<span class="op">=</span><span class="st">&quot;&lt;?php echo </span><span class="va">$_SERVER</span>[<span class="st">&quot;</span><span class="cn">PHP_SELF</span><span class="st">&quot;];?&gt;&quot;</span> method<span class="op">=</span><span class="st">&quot;post&quot;</span><span class="op">&gt;</span></span></code></pre></div>
            <blockquote>
            <p>The <strong><code>$_SERVER["PHP_SELF"]</code></strong> is
            a super global variable that returns the filename of the
            currently executing script.</p>
            </blockquote>
            <p>However this code is vulnerable to some <strong>Cross
            Site Scripting (XSS)</strong> attacks, because and attacker
            can add a Javascript code to the url to execute malicious
            code. Try to add the next string to your form url:</p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>...login<span class="op">.</span>php<span class="op">/%</span><span class="dv">22</span><span class="op">%</span><span class="dv">3</span>E<span class="op">%</span><span class="dv">3</span>Cscript<span class="op">%</span><span class="dv">3</span>Ealert(<span class="st">&#39;hacked&#39;</span>)<span class="op">%</span><span class="dv">3</span>C<span class="op">/</span>script<span class="op">%</span><span class="dv">3</span>E</span></code></pre></div>
            <p>This can be avoided by using the
            <strong><code>htmlspecialchars()</code></strong> function,
            which converts special characters to HTML entities. The form
            code should look like this:</p>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>form method<span class="op">=</span><span class="st">&quot;post&quot;</span> action<span class="op">=</span><span class="st">&quot;&lt;?php echo htmlspecialchars(</span><span class="va">$_SERVER</span>[<span class="st">&quot;</span><span class="cn">PHP_SELF</span><span class="st">&quot;]);?&gt;&quot;</span><span class="op">&gt;</span></span></code></pre></div>
            <h2 data-number="1.2" id="validate-form-data"><span
            class="header-section-number">1.2</span> Validate form
            data</h2>
            <p>In order to get clean data from the inputs, we are going
            to do 2 actions:</p>
            <ul>
            <li>Remove all the tags with the
            <strong><code>strip_tags()</code></strong> function.</li>
            <li>And strip unnecessary characters (extra space, tab,
            newline), with the PHP <strong><code>trim()</code></strong>
            function.</li>
            </ul>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define an array to store the provider values</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">$provider</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;name&#39;</span>]))<span class="ot">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;email&#39;</span>]))<span class="ot">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;cif&#39;</span>]))<span class="ot">;</span></span></code></pre></div>
            <p>At the start of the script, we’ll check if the form has
            been submitted via POST using
            <strong><code>$_SERVER["REQUEST_METHOD"]</code></strong>. If
            the REQUEST_METHOD is POST, then the form has been submitted
            and it should be validated. If it has not been submitted,
            skip the validation and display a blank form:</p>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">// define an array to store the provider values</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">$provider</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="va">$_SERVER</span>[<span class="st">&quot;REQUEST_METHOD&quot;</span>] <span class="op">==</span> <span class="st">&quot;POST&quot;</span>) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;name&#39;</span>]))<span class="ot">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;email&#39;</span>]))<span class="ot">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">=</span> <span class="fu">trim</span>(<span class="fu">strip_tags</span>(<span class="va">$_POST</span>[<span class="st">&#39;cif&#39;</span>]))<span class="ot">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">?&gt;</span></span></code></pre></div>
            <h2 data-number="1.3" id="required-fields"><span
            class="header-section-number">1.3</span> Required
            fields</h2>
            <p>The next step is to make input fields required and create
            error messages if needed.</p>
            <p>We are going to validate the data using a function name
            <code>validateProvider()</code> that accepts an array with
            the provider values and returns an array containing the
            detected errors. If no errors in the inputs, the array will
            be empty.</p>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> validateProvider(<span class="dt">array</span> <span class="va">$provider</span>)<span class="ot">:</span> <span class="dt">array</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">$errors</span><span class="ot">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>In the function, add an <code>if else</code> statement
            for each <code>$_POST</code> variable. This checks if the
            <code>$_POST</code> variable is empty (with the PHP
            <strong><code>empty()</code></strong> function). If it is
            empty, an error message is stored in the different error
            variables, and if it is not empty, it sends the user input
            data:</p>
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> validateProvider(<span class="dt">array</span> <span class="va">$provider</span>)<span class="ot">:</span> <span class="dt">array</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>])) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span>[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Name is required&quot;</span><span class="ot">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>])) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Email is required&quot;</span><span class="ot">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>])) {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">=</span> <span class="st">&quot;* CIF is required&quot;</span><span class="ot">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">$errors</span><span class="ot">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="1.4" id="display-the-error-messages"><span
            class="header-section-number">1.4</span> Display the error
            messages</h2>
            <p>In the HTML form, we’ll add a little script after each
            required field, which generates the correct error
            message:</p>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>label <span class="cf">for</span><span class="op">=</span><span class="st">&quot;name&quot;</span><span class="op">&gt;</span><span class="cn">N</span>ame<span class="ot">:</span><span class="op">&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> id<span class="op">=</span><span class="st">&quot;name&quot;</span> name<span class="op">=</span><span class="st">&quot;name&quot;</span><span class="op">&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$errors</span>[<span class="st">&#39;name&#39;</span>] <span class="op">??</span> <span class="st">&#39;&#39;</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;</span> <span class="op">&lt;</span>br<span class="op">&gt;&lt;</span>br<span class="op">&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>label <span class="cf">for</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="op">&gt;</span><span class="cn">E</span>mail<span class="ot">:</span><span class="op">&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;email&quot;</span> id<span class="op">=</span><span class="st">&quot;email&quot;</span> name<span class="op">=</span><span class="st">&quot;email&quot;</span><span class="op">&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">??</span> <span class="st">&#39;&#39;</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;</span> <span class="op">&lt;</span>br<span class="op">&gt;&lt;</span>br<span class="op">&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>label <span class="cf">for</span><span class="op">=</span><span class="st">&quot;cif&quot;</span><span class="op">&gt;</span><span class="cn">CIF</span><span class="ot">:</span><span class="op">&lt;/</span>label<span class="op">&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> id<span class="op">=</span><span class="st">&quot;cif&quot;</span> name<span class="op">=</span><span class="st">&quot;cif&quot;</span><span class="op">&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>span <span class="kw">class</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$errors</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">??</span> <span class="st">&#39;&#39;</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;&lt;</span>br<span class="op">&gt;&lt;</span>br<span class="op">&gt;</span></span></code></pre></div>
            <p>Note that we are using the null coalescing operator
            (<code>??</code>), so, in case an array’s key is null, we
            print an empty string</p>
            <p>Try it!:</p>
            <p><img src="images/form2.png" /></p>
            <p>The next step is to validate the input data.</p>
            <h2 data-number="1.5" id="validate-inputs"><span
            class="header-section-number">1.5</span> Validate
            inputs</h2>
            <p>For the provider’s name, we only need to check if the
            string has at least 4 characters:</p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>])) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span>[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Name is required&quot;</span><span class="ot">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">elseif</span> (<span class="fu">strlen</span>(<span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>]) <span class="op">&lt;</span> <span class="dv">4</span>) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span>[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Name must be at least 4 characters long&quot;</span><span class="ot">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <blockquote>
            <p>Note that we are showing a different message for each
            error type.</p>
            </blockquote>
            <p>The easiest and safest way to check if an email address
            is well-formed is to use PHP’s
            <strong><code>filter_var()</code></strong> function with the
            <strong><code>FILTER_VALIDATE_EMAIL</code></strong>
            filter.</p>
            <p>In the code below, if the e-mail address is not
            well-formed, then store an error message:</p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>])) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Email is required&quot;</span><span class="ot">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">elseif</span> (<span class="op">!</span><span class="fu">filter_var</span>(<span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>]<span class="ot">,</span> <span class="cn">FILTER_VALIDATE_EMAIL</span>)) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Invalid email format&quot;</span><span class="ot">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
            <p>For the CIF, we need a regular expression to check the
            validity of the string:</p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>])) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">=</span> <span class="st">&quot;* CIF is required&quot;</span><span class="ot">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">elseif</span> (<span class="op">!</span><span class="fu">preg_match</span>(<span class="st">&quot;/^[A-Z a-z]{1}[0-9]{8}$/&quot;</span><span class="ot">,</span> <span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>])) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Invalid CIF format&quot;</span><span class="ot">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="1.6" id="keep-the-values-in-the-form"><span
            class="header-section-number">1.6</span> Keep the values in
            the form</h2>
            <p>Now, if the user submits the values and the inputs have
            any error, the form shows the error messages, but the inputs
            become blank and the user needs to enter the values again.
            This is especially frustrating in long forms!</p>
            <p>To show the values in the input fields after the user
            hits the submit button, we add a little PHP script inside
            the <strong>value</strong> attribute using the echo tag:</p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> id<span class="op">=</span><span class="st">&quot;name&quot;</span> name<span class="op">=</span><span class="st">&quot;name&quot;</span> value<span class="op">=</span><span class="st">&quot;&lt;?= </span><span class="va">$provider</span>[<span class="er">&#39;</span><span class="st">name&#39;] ?? &#39;&#39; ?&gt;&quot;</span><span class="op">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> id<span class="op">=</span><span class="st">&quot;email&quot;</span> name<span class="op">=</span><span class="st">&quot;email&quot;</span> value<span class="op">=</span><span class="st">&quot;&lt;?= </span><span class="va">$provider</span>[<span class="er">&#39;</span><span class="st">email&#39;] ?? &#39;&#39; ?&gt;&quot;</span><span class="op">&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> id<span class="op">=</span><span class="st">&quot;cif&quot;</span> name<span class="op">=</span><span class="st">&quot;cif&quot;</span> value<span class="op">=</span><span class="st">&quot;&lt;?= </span><span class="va">$provider</span>[<span class="er">&#39;</span><span class="st">cif&#39;] ?? &#39;&#39; ?&gt;&quot;</span><span class="op">&gt;</span></span></code></pre></div>
            <h2 data-number="1.7"
            id="send-the-data-to-another-script"><span
            class="header-section-number">1.7</span> Send the data to
            another script</h2>
            <p>If all the checks are ok, it’s time to send the data to
            another script that should insert the data into a database.
            Instead of that, we simply will shoe the submitted data.</p>
            <p>The problem now is how to pass this data. Passing data
            via the GET method is a bad idea for security reasons. And
            our form is passing the data to itself via the POST method.
            So we will use the <strong><code>header()</code></strong>
            statement for redirecting to the another script and session
            variables to store the variables.</p>
            <p>If the script is named <code>show_provider.php</code>,
            the redirection statement should be:</p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">header</span>(<span class="st">&quot;Location:show_provider.php&quot;</span>)<span class="ot">;</span></span></code></pre></div>
            <p>To create a session, call the function:</p>
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">session_start</span>()<span class="ot">;</span></span></code></pre></div>
            <p>at the start of your scripts.</p>
            <p>On the form script we must store the POST data in a
            session variable before we validate them:</p>
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="va">$_SESSION</span>[<span class="st">&#39;provider&#39;</span>] <span class="op">=</span> <span class="va">$provider</span><span class="ot">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">$errors</span> <span class="op">=</span> validateProvider(<span class="va">$provider</span>)<span class="ot">;</span></span></code></pre></div>
            <p>If the validation is passed, the errors array will be
            empty, so we can redirect to the
            <code>show_provider.php</code>:</p>
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>)) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&quot;Location:show_provider.php&quot;</span>)<span class="ot">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>View the <a
            href="https://github.com/ricardoprofe/providers_sample_DWES_24_25/blob/main/provider_form.php">complete
            code</a>.</p>
            <p>The <code>show_provider.php</code> script simply gets the
            session variables and compare them with the correct values,
            showing a message according to the result:</p>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">session_start</span>()<span class="ot">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;provider&#39;</span>])) {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">$provider</span> <span class="op">=</span> <span class="va">$_SESSION</span>[<span class="st">&#39;provider&#39;</span>]<span class="ot">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">echo</span> <span class="st">&quot;&lt;p&gt;Name: &quot;</span> <span class="op">.</span> <span class="va">$provider</span>[<span class="st">&#39;name&#39;</span>] <span class="op">.</span> <span class="st">&quot;&lt;/p&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">echo</span> <span class="st">&quot;&lt;p&gt;Email: &quot;</span> <span class="op">.</span> <span class="va">$provider</span>[<span class="st">&#39;email&#39;</span>] <span class="op">.</span> <span class="st">&quot;&lt;/p&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">echo</span> <span class="st">&quot;&lt;p&gt;CIF: &quot;</span> <span class="op">.</span> <span class="va">$provider</span>[<span class="st">&#39;cif&#39;</span>] <span class="op">.</span> <span class="st">&quot;&lt;/p&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">echo</span> <span class="st">&quot;&lt;p&gt;No provider data&lt;/p&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">session_destroy</span>()<span class="ot">;</span></span></code></pre></div>
            <p>You can get all the code from the <a
            href="https://github.com/ricardoprofe/providers_sample_DWES_24_25">GitHub
            repository</a>.</p>
        </main>
        

        <!--- Modal images -->

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- The Close Button -->
            <!--span class="close">&times;</span-->

            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="img01">

            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>

        <!-- End Modal Images -->

        <!-- Snackbar for copy code -->
        <div id="snackbar">Codi copiat!</div>
        <!-- End Snackbar -->

        <script>
            function ModalizeImages() {
                // Script basat en https://www.w3schools.com/howto/howto_css_modal_images.asp
                // PEr ampliar imatges en fer click

                // Get the modal
                var modal = document.getElementById("myModal");

                var modalImg = document.getElementById("img01");
                var captionText = document.getElementById("caption");

                // Get the image and insert it inside the modal - use its "alt" text as a caption
                //var img = document.getElementById("myImg");
                document.querySelectorAll("img").forEach((img => {
                        img.onclick = function() {
                            modal.style.display = "block";
                            modalImg.src = this.src;
                            captionText.innerHTML = this.alt;
                        }
                    }))
                    // Get the <span> element that closes the modal
                var span = document.getElementsByClassName("close")[0];

                // When the user clicks on <span> (x), close the modal
                //span.onclick = function() {
                myModal.onclick = function() {
                    modal.style.display = "none";
                }


            }


            function markItem(id) {
                // Restaurem format de tots
                document.querySelectorAll("#TOC a").forEach(function(item) {
                        //item.style.fontWeight = "300";
                        item.classList.remove("navItemSelected");
                    })
                    //item.style.color = "#ff0000";

                // Afegim format
                let items = document.querySelectorAll("#TOC a[href='#" + id + "']");
                items.forEach(function(item) {
                    //item.style.fontWeight = "bolder";
                    item.classList.add("navItemSelected");
                })

            }

            var observer = new IntersectionObserver(function(entries) {
                // isIntersecting is true when element and viewport are overlapping
                // isIntersecting is false when element and viewport don't overlap
                if (entries[0].isIntersecting === true) {
                    let id = entries[0].target.id;
                    markItem(id);
                }

            }, {
                threshold: [0]
            });

            window.addEventListener("load", function() {
                document.querySelectorAll("h1, h2, h3").forEach(function(item) {
                    observer.observe(item);
                });

                document.querySelectorAll("#TOC a").forEach(function(item) {
                    item.addEventListener("click", function(item) {
                        markItem(item.id);
                    })
                })

                // Fem modals totes les imatges
                ModalizeImages();
            })

            document.querySelector("#TOC").addEventListener("click", function(event) {
                let toc = event.target
                if (toc.offsetWidth > 10) {
                    toc.classList.add("minimizedToc");
                }
            })

            document.querySelector("#TOC").addEventListener("mouseover", function(event) {
                let toc = event.target
                if (toc.classList.contains("minimizedToc"))
                    toc.classList.remove("minimizedToc");
            })


                        
            /* PER COPIAR CODI */


            // Busca tots els elements amb la classe "sourceCode"
            var sourceCodeElements = document.querySelectorAll('div.sourceCode');

            /*Afegim el botó a tots els divs */
            // Afegir un botó per a cada element "sourceCode"
            sourceCodeElements.forEach(function(element) {
                console.log(element.id);
                var button = document.createElement('div');
                button.className = 'button-copy';

                // Afegir una icona al botó (fa servir FontAwesome com a exemple)
                //var icon = document.createElement('i');
                //icon.className = 'fas fa-copy'; // Utilitza l'ícona "copy" de FontAwesome

                // Obté l'ID de l'element actual
                var elementId = element.id;

                // Afegeix un event listener al botó per cridar la funció amb l'ID
                button.addEventListener('click', function() {
                    copyContent(elementId);
                });

                // Afegeix l'icona al botó i el botó just dins de l'element "sourceCode"
                //button.appendChild(icon);
                element.appendChild(button);
            });



            // Funció per copiar el contingut d'un element amb l'ID donat
            function copyContent(elementId) {
                var element = document.getElementById(elementId);
                var textToCopy = element.innerText;

                // Crea un element de text i copia el contingut
                var textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);

                // Selecciona i copia el text
                textArea.select();
                document.execCommand('copy');

                // Elimina l'element de text afegit temporalment
                document.body.removeChild(textArea);

                // Notifica a l'usuari que el codi s'ha copiat
                mostraSnackbar();
            }

            /* SNACKBAR EN COPIAR CODI */

            function mostraSnackbar() {
            // Busquem l'snackbar
            var x = document.getElementById("snackbar");

            // Li afegim la classe show
            x.className = "show";

            // I als tres segons la llevem
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            } 




        </script>
    </div>
</body>

</html>