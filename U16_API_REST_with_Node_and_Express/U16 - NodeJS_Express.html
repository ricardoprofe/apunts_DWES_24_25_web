<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-UK" xml:lang="en-UK" >

<head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />     <meta name="author" content="Fidel Oltra, Ricardo Sánchez" />        <title>Unit 16. API REST with Node.js and Express</title>
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        div.columns{display: flex; gap: min(4vw, 1.5em);}
        div.column{flex: auto; overflow-x: auto;}
        div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
        /* The extra [class] is a hack that increases specificity enough to
           override a similar rule in reveal.js */
        ul.task-list[class]{list-style: none;}
        ul.task-list li input[type="checkbox"] {
          font-size: inherit;
          width: 0.8em;
          margin: 0 0.8em 0.2em -1.6em;
          vertical-align: middle;
        }
        .display.math{display: block; text-align: center; margin: 0.5rem auto;}
        /* CSS for syntax highlighting */
        pre > code.sourceCode { white-space: pre; position: relative; }
        pre > code.sourceCode > span { line-height: 1.25; }
        pre > code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        pre > code.sourceCode { white-space: pre-wrap; }
        pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {  background-color: #f8f8f8; }
        @media screen {
        pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ef2929; } /* Alert */
        code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
        code span.at { color: #204a87; } /* Attribute */
        code span.bn { color: #0000cf; } /* BaseN */
        code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
        code span.ch { color: #4e9a06; } /* Char */
        code span.cn { color: #8f5902; } /* Constant */
        code span.co { color: #8f5902; font-style: italic; } /* Comment */
        code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
        code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
        code span.dt { color: #204a87; } /* DataType */
        code span.dv { color: #0000cf; } /* DecVal */
        code span.er { color: #a40000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.fl { color: #0000cf; } /* Float */
        code span.fu { color: #204a87; font-weight: bold; } /* Function */
        code span.im { } /* Import */
        code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
        code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
        code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
        code span.ot { color: #8f5902; } /* Other */
        code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
        code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
        code span.ss { color: #4e9a06; } /* SpecialString */
        code span.st { color: #4e9a06; } /* String */
        code span.va { color: #000000; } /* Variable */
        code span.vs { color: #4e9a06; } /* VerbatimString */
        code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
        <link rel="stylesheet" href="../web_template/aqua.css" />  
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
      
</head>

<body>
    <div id="content">
                 <header id="title-block-header">
            <h1 class="title">Unit 16. API REST with Node.js and
Express</h1>
            <!---->
            <!--         <p class="author">Fidel Oltra, Ricardo
Sánchez</p>
         -->
                    </header>
                 <nav id="TOC" role="doc-toc">
            <div class="navContainer">
                                <h2 id="toc-title">Index</h2>
                 <ul>
<li><a href="#api-rest.-a-little-reminder."
id="toc-api-rest.-a-little-reminder."><span
class="toc-section-number">1</span> API REST. A little
reminder.</a></li>
<li><a href="#javascript-and-json" id="toc-javascript-and-json"><span
class="toc-section-number">2</span> Javascript and JSON</a></li>
<li><a href="#json-and-rest-services"
id="toc-json-and-rest-services"><span
class="toc-section-number">3</span> JSON and REST services</a></li>
<li><a href="#the-express-framework"
id="toc-the-express-framework"><span class="toc-section-number">4</span>
The EXPRESS framework</a>
<ul>
<li><a href="#installing-express" id="toc-installing-express"><span
class="toc-section-number">4.1</span> Installing EXPRESS</a></li>
<li><a href="#a-simple-example" id="toc-a-simple-example"><span
class="toc-section-number">4.2</span> A simple example</a></li>
</ul></li>
<li><a href="#developing-services" id="toc-developing-services"><span
class="toc-section-number">5</span> Developing services</a>
<ul>
<li><a href="#a-simple-service" id="toc-a-simple-service"><span
class="toc-section-number">5.1</span> A simple service</a></li>
<li><a href="#exercise-01" id="toc-exercise-01"><span
class="toc-section-number">5.2</span> Exercise 01</a></li>
</ul></li>
<li><a href="#objects-app-req-and-res"
id="toc-objects-app-req-and-res"><span
class="toc-section-number">6</span> Objects app, req and res</a>
<ul>
<li><a href="#the-app-object" id="toc-the-app-object"><span
class="toc-section-number">6.1</span> The <code>app</code>
object</a></li>
<li><a href="#the-req-object" id="toc-the-req-object"><span
class="toc-section-number">6.2</span> The <code>req</code>
object</a></li>
<li><a href="#the-res-object" id="toc-the-res-object"><span
class="toc-section-number">6.3</span> The <code>res</code>
object</a></li>
</ul></li>
<li><a href="#a-complete-api-rest" id="toc-a-complete-api-rest"><span
class="toc-section-number">7</span> A complete API REST</a>
<ul>
<li><a href="#post" id="toc-post"><span
class="toc-section-number">7.1</span> POST</a></li>
<li><a href="#exercise-02" id="toc-exercise-02"><span
class="toc-section-number">7.2</span> Exercise 02</a></li>
<li><a href="#get-all" id="toc-get-all"><span
class="toc-section-number">7.3</span> GET (all)</a></li>
<li><a href="#get-by-id" id="toc-get-by-id"><span
class="toc-section-number">7.4</span> GET by id</a></li>
<li><a href="#other-gets" id="toc-other-gets"><span
class="toc-section-number">7.5</span> OTHER GETS</a></li>
<li><a href="#put" id="toc-put"><span
class="toc-section-number">7.6</span> PUT</a></li>
<li><a href="#put-using-a-filter" id="toc-put-using-a-filter"><span
class="toc-section-number">7.7</span> PUT using a filter</a></li>
<li><a href="#delete-a-document" id="toc-delete-a-document"><span
class="toc-section-number">7.8</span> DELETE a document</a></li>
</ul></li>
</ul>
            </div>
        </nav>
                <main>
            <h1 data-number="1" id="api-rest.-a-little-reminder."><span
            class="header-section-number">1</span> API REST. A little
            reminder.</h1>
            <p>If you remember, we learned the foundations of REST API
            in unit 8. We took a look at the theory, and then we made
            some practical examples. Let’s review the basic
            concepts:</p>
            <ul>
            <li>In a REST system, each resource is identified by a URI,
            optional parameters and a method.</li>
            <li>The method are GET, POST, PUT and DELETE,
            basically.</li>
            </ul>
            <p>By identifying the resource to request (URI) and the
            command to apply to it, the server that offers this API REST
            provides a response to that request. This response is
            typically given by a message in JSON format.</p>
            <p>We can check the services using a client application or
            using online tools like POSTMAN or <a
            href="https://hoppscotch.io/">hoopscotch</a> as we saw in
            previous units.</p>
            <h1 data-number="2" id="javascript-and-json"><span
            class="header-section-number">2</span> Javascript and
            JSON</h1>
            <p>A JSON object, as you know, is defined by a series of
            properties and values. In Javascript we can create an object
            as a variable:</p>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> person <span class="op">=</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Fidel&quot;</span><span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Oltra&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">age</span><span class="op">:</span> <span class="dv">57</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
            <p>This object, translated to JSON format, looks like
            this:</p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{<span class="st">&quot;name&quot;</span><span class="op">:</span><span class="st">&quot;Fidel&quot;</span><span class="op">,</span><span class="st">&quot;surname&quot;</span><span class="op">:</span><span class="st">&quot;Oltra&quot;</span><span class="op">,</span><span class="st">&quot;age&quot;</span><span class="op">:</span><span class="dv">57</span>}</span></code></pre></div>
            <p>Same for an array of objects:</p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> persons <span class="op">=</span> [</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Fidel&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Oltra&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">57</span>}<span class="op">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;David&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Sánchez&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">23</span>}<span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Martha&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Lee&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">20</span>}<span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;James&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Williams&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">38</span>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
            <p>Transformed into JSON format:</p>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  [{<span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Fidel&quot;</span><span class="op">,</span> <span class="st">&quot;surname&quot;</span><span class="op">:</span> <span class="st">&quot;Oltra&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">57</span>}<span class="op">,</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  { <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;David&quot;</span><span class="op">,</span> <span class="st">&quot;surname&quot;</span><span class="op">:</span> <span class="st">&quot;Sánchez&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">23</span>}<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  { <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Martha&quot;</span><span class="op">,</span> <span class="st">&quot;surname&quot;</span><span class="op">:</span> <span class="st">&quot;Lee&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">20</span>}<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  { <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;James&quot;</span><span class="op">,</span> <span class="st">&quot;surname&quot;</span><span class="op">:</span> <span class="st">&quot;Williams&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">38</span>}]</span></code></pre></div>
            <p>JavaScript offers some methods for converting data to
            JSON format and vice versa. These methods are
            <code>JSON.stringify</code> to convert a JavaScript object
            or array to JSON, and <code>JSON.parse</code> to convert a
            JSON string into a Javascript object.</p>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> persons <span class="op">=</span> [</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Fidel&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Oltra&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">57</span>}<span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;David&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Sánchez&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">23</span>}<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Martha&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Lee&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">20</span>}<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;James&quot;</span><span class="op">,</span> <span class="dt">surname</span><span class="op">:</span> <span class="st">&quot;Williams&quot;</span><span class="op">,</span> <span class="st">&quot;age&quot;</span><span class="op">:</span> <span class="dv">38</span>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// From array to JSON</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> personsJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(persons)<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(personsJSON)<span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// From JSON to array</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> personsArray <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(personsJSON)<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(personsArray)<span class="op">;</span></span></code></pre></div>
            <p>The result:</p>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[</span><span class="dt">{</span><span class="st">&quot;name&quot;</span><span class="dt">:</span><span class="st">&quot;Fidel&quot;</span><span class="op">,</span><span class="st">&quot;surname&quot;</span><span class="dt">:</span><span class="st">&quot;Oltra&quot;</span><span class="op">,</span><span class="st">&quot;age&quot;</span><span class="dt">:57}</span><span class="ex">,</span><span class="dt">{</span><span class="st">&quot;name&quot;</span><span class="dt">:</span><span class="st">&quot;David&quot;</span><span class="op">,</span><span class="st">&quot;surname&quot;</span><span class="dt">:</span><span class="st">&quot;Sánchez&quot;</span><span class="op">,</span><span class="st">&quot;age&quot;</span><span class="dt">:23}</span><span class="ex">,</span><span class="dt">{</span><span class="st">&quot;name&quot;</span><span class="dt">:</span><span class="st">&quot;Martha&quot;</span><span class="op">,</span><span class="st">&quot;surname&quot;</span><span class="dt">:</span><span class="st">&quot;Lee&quot;</span><span class="op">,</span><span class="st">&quot;age&quot;</span><span class="dt">:20}</span><span class="ex">,</span><span class="dt">{</span><span class="st">&quot;name&quot;</span><span class="dt">:</span><span class="st">&quot;James&quot;</span><span class="op">,</span><span class="st">&quot;surname&quot;</span><span class="dt">:</span><span class="st">&quot;Williams&quot;</span><span class="op">,</span><span class="st">&quot;age&quot;</span><span class="dt">:38}</span><span class="ex">]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  { name: <span class="st">&#39;Fidel&#39;</span>, <span class="er">surname:</span> <span class="st">&#39;Oltra&#39;</span><span class="ex">,</span> age: 57 },</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">{</span> <span class="ex">name:</span> <span class="st">&#39;David&#39;</span>, surname: <span class="st">&#39;Sánchez&#39;</span>, age: 23 },</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">{</span> <span class="ex">name:</span> <span class="st">&#39;Martha&#39;</span>, surname: <span class="st">&#39;Lee&#39;</span>, age: 20 },</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">{</span> <span class="ex">name:</span> <span class="st">&#39;James&#39;</span>, surname: <span class="st">&#39;Williams&#39;</span>, age: 38 }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">]</span></span></code></pre></div>
            <h1 data-number="3" id="json-and-rest-services"><span
            class="header-section-number">3</span> JSON and REST
            services</h1>
            <p>We will use JSON to create the response we send back when
            we receive a request. When preparing a response to a service
            using JSON format, this response usually will have a certain
            format. In general, in the responses we will use a structure
            based on:</p>
            <ul>
            <li>A boolean data (like <code>ok</code>) to indicate if the
            request was succesful or not</li>
            <li>An error message (like <code>error</code>) just in case
            something goes wrong (if <code>ok</code> is false)</li>
            <li>The response data (like <code>result</code> or any
            specific name) if the request has been succesful (if
            <code>ok</code> is true)</li>
            <li>Additionally we can add to the response an standard HTTP
            status code [HTTP status codes]
            (https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)</li>
            </ul>
            <h1 data-number="4" id="the-express-framework"><span
            class="header-section-number">4</span> The EXPRESS
            framework</h1>
            <p><strong>Express</strong> is a lightweight, flexible and
            powerful framework for developing web applications with
            Node. It is lightweight because it does not come by default
            with all the available functionality. Using Node and
            middleware modules, we can add later all the functionality
            required for each type of application. This way, we can the
            lighter version for simple web applications, and add more
            elements as we need them to develop more complex
            applications. That means we can use Express to create from
            static content servers (HTML, CSS and Javascript) to very
            complex web services.</p>
            <p>More information about Express in the <a
            href="http://expressjs.com/">official Express
            website</a></p>
            <h2 data-number="4.1" id="installing-express"><span
            class="header-section-number">4.1</span> Installing
            EXPRESS</h2>
            <p>Installing Express is as simple as with any other module
            that we want to incorporate into our Node project. We simply
            need to use <code>npm</code> in the project folder:</p>
            <ul>
            <li>first, if we don’t have a <code>package.json</code> file
            yet, doing <code>npm init</code></li>
            <li>then, once we have the <code>package.json</code> file,
            installing EXPRESS with
            <code>npm install express --save</code></li>
            </ul>
            <h2 data-number="4.2" id="a-simple-example"><span
            class="header-section-number">4.2</span> A simple
            example</h2>
            <p>Let’s create a project named <code>ExpressTest</code>.
            Create the folder and install EXPRESS. Then, create an
            <code>index.js</code> file with this content:</p>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">8080</span>)<span class="op">;</span></span></code></pre></div>
            <p>We have created an EXPRESS object, and then we called a
            method <code>listen</code> to listen HTTP requests.</p>
            <p>Now run the <code>index.js</code> script, go to you
            browser and write the URL
            <code>http://localhost:8080</code>.</p>
            <p>We will get an error like this:</p>
            <p><strong>Cannot GET /</strong></p>
            <p>As the server it’s not yet prepared to respond any
            request, we get an error message when trying to access any
            URL. Now, let’s create some basic services.</p>
            <h1 data-number="5" id="developing-services"><span
            class="header-section-number">5</span> Developing
            services</h1>
            <p>We must add some routes on our main server to support the
            services. Once we have initialized the application (app
            variable), we will just add the basic methods (get, post,
            put or delete), indicating for each one:</p>
            <ul>
            <li>the path or URI that should be attended</li>
            <li>the callback or function that will be executed</li>
            </ul>
            <h2 data-number="5.1" id="a-simple-service"><span
            class="header-section-number">5.1</span> A simple
            service</h2>
            <p>Let’s create a simple GET service attending the route
            <code>/welcome</code>. In your <code>index.js</code> file,
            add a method <code>app.get</code> like this:</p>
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/welcome&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hi, welcome to my app&#39;</span>)<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">8080</span>)<span class="op">;</span></span></code></pre></div>
            <p>If your server is running, restart it (close the terminal
            and run <code>node index.js</code> again). Then open your
            browser and go to the url
            <code>http://localhost:8080/welcome</code>. You should get
            the message:</p>
            <p><strong>Hi, welcome to my app</strong></p>
            <p>Let’s analyze the code. The <code>app.get</code> method
            has two parameters:</p>
            <ul>
            <li>the route, in this case <code>/welcome</code></li>
            <li>the callback function, with two parameters:
            <strong>req</strong> and <strong>res</strong>.</li>
            </ul>
            <p><strong>req</strong> is the object with the client
            request, and <strong>res</strong> is the object with the
            response. We will use the <strong>req</strong> object to get
            information about the request, and <strong>res</strong> to
            send the response to the client. In our example, we are not
            reading any data from the request and we send (method
            <code>res.send</code>) a message as the only content in the
            response.</p>
            <p>We can create the other services (post, put, delete) and
            return a different message in each of them.</p>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/welcome&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hi, you are sending a GET request to my app&#39;</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>(<span class="st">&#39;/welcome&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hi, you are sending a POST request to my app&#39;</span>)<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>(<span class="st">&#39;/welcome&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hi, you are sending a PUT request to my app&#39;</span>)<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">delete</span>(<span class="st">&#39;/welcome&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hi, you are sending a DELETE request to my app&#39;</span>)<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">8080</span>)<span class="op">;</span></span></code></pre></div>
            <p>Now, to test the services, we must restart the app
            closing and executing again <code>index.js</code>. We only
            can send GET requests from the browser, so we need to use a
            web client like <code>Postman</code>,
            <code>Hoppscotch.io</code> or similar to test the other
            services.</p>
            <figure>
            <img src="images/image01.png" alt="GET request" />
            <figcaption aria-hidden="true">GET request</figcaption>
            </figure>
            <figure>
            <img src="images/image02.png" alt="POST request" />
            <figcaption aria-hidden="true">POST request</figcaption>
            </figure>
            <figure>
            <img src="images/image03.png" alt="PUT request" />
            <figcaption aria-hidden="true">PUT request</figcaption>
            </figure>
            <figure>
            <img src="images/image04.png" alt="DELETE request" />
            <figcaption aria-hidden="true">DELETE request</figcaption>
            </figure>
            <h2 data-number="5.2" id="exercise-01"><span
            class="header-section-number">5.2</span> Exercise 01</h2>
            <p>Use the node library <strong>os</strong> to show the user
            name in the messages like we did in the previous unit.</p>
            <h1 data-number="6" id="objects-app-req-and-res"><span
            class="header-section-number">6</span> Objects app, req and
            res</h1>
            <p>To create more complex services, we need to know more
            about the <code>app</code>, <code>req</code> and
            <code>res</code> objects.</p>
            <h2 data-number="6.1" id="the-app-object"><span
            class="header-section-number">6.1</span> The
            <code>app</code> object</h2>
            <p>The <strong>application</strong> is an instance of an
            <strong>Express</strong> object. In our example, we created
            a variable called <code>app</code>. This is and object with
            methods like:</p>
            <ul>
            <li><strong>use()</strong> to add middleware to the
            project</li>
            <li><strong>set()</strong> to create and assign a value to
            some project properties</li>
            <li><strong>get()</strong> to get the value of some project
            properties</li>
            <li><strong>listen()</strong> to specify which port the
            application will be listening on</li>
            </ul>
            <p>For example, to retrieve the value of a setting with
            <code>app.get()</code>:</p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;My Site&#39;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;title&#39;</span>) <span class="co">// &quot;My Site&quot;</span></span></code></pre></div>
            <p>The object has some more methods that we will be seeing
            in the next examples.</p>
            <h2 data-number="6.2" id="the-req-object"><span
            class="header-section-number">6.2</span> The
            <code>req</code> object</h2>
            <p>The <strong>request</strong> (in our example,
            <strong><code>req</code></strong>) object is created when a
            client sends a request to an Express server. This object
            contains several useful methods and properties that will
            allow us to access information contained in the petition,
            such as:</p>
            <ul>
            <li><strong>params</strong> the parameters of the
            request</li>
            <li><strong>query</strong> the parameters sent using the URL
            query string (after the ? in the URL)</li>
            <li><strong>body</strong> the information sent using the
            body of the request</li>
            <li><strong>files</strong> the files that a client uploads
            using a form</li>
            <li><strong>get()</strong> to get some specific parameters
            from the request</li>
            <li><strong>path</strong> to get the path or URL from the
            request</li>
            <li><strong>url</strong> to get the URL and the
            <code>query string</code> parameters (those after the ? in
            the URL)</li>
            </ul>
            <h2 data-number="6.3" id="the-res-object"><span
            class="header-section-number">6.3</span> The
            <code>res</code> object</h2>
            <p>The <strong>response</strong> object (in our example,
            <strong><code>res</code></strong>) is created along with the
            <strong>req</strong> object. In the service code we will
            complete this object with some data that we want to send
            back to the client. The object has, among others, these
            methods and properties:</p>
            <ul>
            <li><strong>status(code)</strong> to establish the state
            code for our response</li>
            <li><strong>set(header, value)</strong> to establish a value
            to be returned in a header</li>
            <li><strong>redirect(status, url)</strong> to redirect to
            another URL with a certain status code</li>
            <li><strong>send([status], body)</strong> to return a
            content along with an optional status code</li>
            <li><strong>json([status], body)</strong> to return JSON
            content along with an optional status code</li>
            <li><strong>render(view,[options])</strong> to render a
            certain view as a response with the possibility of adding
            some options</li>
            </ul>
            <h1 data-number="7" id="a-complete-api-rest"><span
            class="header-section-number">7</span> A complete API
            REST</h1>
            <p>Let’s create a complete API REST for our
            <code>contacts</code> collection in MongoDB. We will assume
            that we have a unique collection with the favourite
            restaurants and the pets as subdocuments inside the
            <code>contact</code> document. Thus, we will define the
            three schemas (for <code>contact</code>,
            <code>restaurant</code> and <code>pet</code>) in the same
            <code>contact.js</code> file.</p>
            <p><strong>contact.js</strong></p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;mongoose&#39;</span>)<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Defining the scheme for contacts</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">// adding the restaurant and the pets as subdocuments</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">// inside the contact document</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> restaurantSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minlength</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">address</span><span class="op">:</span> {</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minlength</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">phone</span><span class="op">:</span> {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">match</span><span class="op">:</span> <span class="ss">/</span><span class="sc">^\d{9}$</span><span class="ss">/</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> petSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minlength</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> {</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enum</span><span class="op">:</span> [<span class="st">&#39;dog&#39;</span><span class="op">,</span> <span class="st">&#39;cat&#39;</span><span class="op">,</span> <span class="st">&#39;others&#39;</span>]</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> contactSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minlength</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="dt">phone</span><span class="op">:</span> {</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trim</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">match</span><span class="op">:</span> <span class="ss">/</span><span class="sc">^\d{9}$</span><span class="ss">/</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="dt">age</span><span class="op">:</span> {</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="bu">Number</span><span class="op">,</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">min</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">max</span><span class="op">:</span> <span class="dv">120</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="dt">favouriteRestaurant</span><span class="op">:</span> restaurantSchema<span class="op">,</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pets</span><span class="op">:</span> [petSchema]</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> Contact <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&#39;contact&#39;</span><span class="op">,</span>contactSchema)<span class="op">;</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> Contact<span class="op">;</span></span></code></pre></div>
            <p>Now, in our <code>index.js</code> file, we must
            write:</p>
            <p><strong>index.js</strong></p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;mongoose&#39;</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> bodyParser <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;body-parser&#39;</span>)<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Contact <span class="op">=</span> <span class="pp">require</span>(<span class="bu">__dirname</span> <span class="op">+</span> <span class="st">&quot;/contact.js&quot;</span>)<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>mongoose<span class="op">.</span><span class="fu">connect</span>(<span class="st">&#39;mongodb://172.17.0.1:27017/contacts_subdocuments&#39;</span>)<span class="op">;</span></span></code></pre></div>
            <p>This way, we are requiring some needed libraries and the
            <strong>Contact</strong> schema. Then we connect to a Mongo
            database called <strong>contacts_subdocuments</strong></p>
            <p>Now we can create the services.</p>
            <h2 data-number="7.1" id="post"><span
            class="header-section-number">7.1</span> POST</h2>
            <p>As our collection is empty, we need to add some contacts.
            First, we need to create the app and a middleware
            <code>express.json()</code> to parse the content of
            <code>req.body</code>:</p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">json</span>())<span class="op">;</span></span></code></pre></div>
            <p>Now we can create the POST service:</p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>(<span class="st">&#39;/contact&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// we check if body has some content</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(req<span class="op">.</span><span class="at">body</span>) {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// optionally, we can check if body includes all the information we need</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">restaurant</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span>) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">// we create the Contact</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> newContact <span class="op">=</span> <span class="kw">new</span> <span class="fu">Contact</span>({</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                <span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">phone</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span><span class="op">,</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">age</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span><span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">favouriteRestaurant</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">restaurant</span><span class="op">,</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                <span class="dt">pets</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// and then we save the contact into the collection</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            newContact<span class="op">.</span><span class="fu">save</span>()<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">resul</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>              })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Error adding the contact &quot;</span><span class="op">,</span>error<span class="op">,</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                <span class="dt">contact</span><span class="op">:</span> newContact})<span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>            <span class="co">// if some required parameter is missing in body</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Some parameter is missing&#39;</span>)<span class="op">;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// if body is not valid</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Invalid request body&#39;</span>)<span class="op">;</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
            <p>Now, from our web client we must send a POST request with
            an <code>application/json</code> in the body with this
            format:</p>
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;name&quot;</span><span class="fu">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;phone&quot;</span><span class="fu">:</span><span class="st">&quot;phone&quot;</span><span class="fu">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;age&quot;</span><span class="fu">:</span><span class="st">&quot;age&quot;</span><span class="fu">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;restaurant&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;name of the restaurant&quot;</span><span class="fu">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;address&quot;</span><span class="fu">:</span><span class="st">&quot;address of the restaurant&quot;</span><span class="fu">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;phone&quot;</span><span class="fu">:</span><span class="st">&quot;phone of the restaurant&quot;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">},</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&quot;pets&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;name&quot;</span><span class="fu">,</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;type&quot;</span><span class="fu">}</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;name&quot;</span><span class="fu">,</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;type&quot;</span><span class="fu">}</span><span class="ot">,</span><span class="er">...</span><span class="ot">]</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>Let’s try with this one:</p>
            <figure>
            <img src="images/image05.png" width="400"
            alt="a POST request" />
            <figcaption aria-hidden="true">a POST request</figcaption>
            </figure>
            <p>We will get this result:</p>
            <figure>
            <img src="images/image06.png" alt="POST OK" />
            <figcaption aria-hidden="true">POST OK</figcaption>
            </figure>
            <blockquote>
            <p>Remember to restart Node when you make changes to the
            code. Or you can use <code>nodemon</code> as explained in
            the unit 14.</p>
            </blockquote>
            <p>We can simplify the code to relay on the model validation
            (remember that we only require the contact’s name and
            phone):</p>
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> newContact <span class="op">=</span> <span class="kw">new</span> <span class="fu">Contact</span>({</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">phone</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span><span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">age</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span><span class="op">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">favouriteRestaurant</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">favouriteRestaurant</span><span class="op">,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pets</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  newContact<span class="op">.</span><span class="fu">save</span>()<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Error adding contact&quot;</span>})<span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <h2 data-number="7.2" id="exercise-02"><span
            class="header-section-number">7.2</span> Exercise 02</h2>
            <ul>
            <li><p>Try to do a new POST request to create a new contact
            but with the same phone number as the previous
            contact.</p></li>
            <li><p>Try to do a new POST request with a phone with more
            than 9 digits</p></li>
            </ul>
            <p>In both cases you should get an error. Why?</p>
            <h2 data-number="7.3" id="get-all"><span
            class="header-section-number">7.3</span> GET (all)</h2>
            <p>Of course, we can check if the contacts have been added
            to the collection directly from Mongo, but we also want to
            create a service that returns the contact list.</p>
            <p>To get the whole list of contacts, we just need to do a
            <code>find</code> just as in Mongo and then create the
            response. As you can see, it’s quite easy.</p>
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/contact&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    Contact<span class="op">.</span><span class="fu">find</span>()<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">send</span>( {<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">catch</span> (error <span class="kw">=&gt;</span> {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">send</span>( {<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>              <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Error reading contacts&quot;</span>})<span class="op">;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <figure>
            <img src="images/image07.png" alt="A GET request" />
            <figcaption aria-hidden="true">A GET request</figcaption>
            </figure>
            <h2 data-number="7.4" id="get-by-id"><span
            class="header-section-number">7.4</span> GET by id</h2>
            <p>Usually when we want to get a document by its id, the id
            is sent as a parameter in the route. Thus, the method should
            be like this:</p>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/contact/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <p>Inside the method, we can read the <code>:id</code>
            parameter by doing:</p>
            <div class="sourceCode" id="cb19"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> idcontact <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">;</span></span></code></pre></div>
            <p>And now, using the <code>findById</code> method we can
            find the contact with the given id.</p>
            <div class="sourceCode" id="cb20"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/contact/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> idContact <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  Contact<span class="op">.</span><span class="fu">findById</span>(idContact)<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(result)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>          <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;The contact doesn&#39;t exist&quot;</span>})<span class="op">;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">catch</span> (error <span class="kw">=&gt;</span> {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>          <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Error searching the contact&quot;</span>})<span class="op">;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <p>Let’s check the service from our web client:</p>
            <figure>
            <img src="images/image08.png" alt="A GET by the id" />
            <figcaption aria-hidden="true">A GET by the id</figcaption>
            </figure>
            <p>Try to seek an id that doesn’t exist and see what
            happens.</p>
            <blockquote>
            <p>If we attach the parameter as a <strong>query
            string</strong> like in <code>/contact?id=...</code> we
            should read the parameter with <code>req.query.id</code>
            instead of <code>req.params.id</code></p>
            </blockquote>
            <h2 data-number="7.5" id="other-gets"><span
            class="header-section-number">7.5</span> OTHER GETS</h2>
            <p>We can use the <code>find()</code> method to get the
            documents that match a condition. We can use the <a
            href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/">projections</a>
            and the <a
            href="https://www.mongodb.com/docs/manual/reference/operator/query/#std-label-query-projection-operators-top">query
            operators</a></p>
            <p>Let’s create a service to find a contact by its name.</p>
            <div class="sourceCode" id="cb21"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/contact/byname/:name&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> contactName <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    Contact<span class="op">.</span><span class="fu">find</span>({<span class="st">&quot;name&quot;</span><span class="op">:</span>contactName})<span class="op">.</span><span class="fu">then</span>(resultado <span class="kw">=&gt;</span> {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(resultado)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">resultado</span><span class="op">:</span> resultado})<span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;The contact doesn&#39;t exist&quot;</span>})<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        })<span class="op">.</span><span class="fu">catch</span> (error <span class="kw">=&gt;</span> {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Error searching the contact&quot;</span>})<span class="op">;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <figure>
            <img src="images/image09.png" alt="A GET by the name" />
            <figcaption aria-hidden="true">A GET by the
            name</figcaption>
            </figure>
            <p>We can use regular expressions and <code>regex</code> to
            find the contacts which name matches a pattern. For example,
            if we try to use the previous method to find the contacts
            with the name “Lola” we will get none, because the complete
            name is “Lola Flores”. However, we can modify the service to
            make a partial search by the name using
            <code>regexp</code>.</p>
            <div class="sourceCode" id="cb22"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> contactName <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regex <span class="op">=</span> <span class="kw">new</span> <span class="bu">RegExp</span>(contactName<span class="op">,</span><span class="st">&#39;i&#39;</span>)<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>Contact<span class="op">.</span><span class="fu">find</span>({<span class="st">&quot;name&quot;</span><span class="op">:</span> { <span class="dt">$regex</span><span class="op">:</span> regex}})<span class="op">.</span><span class="fu">then</span>(resultado <span class="kw">=&gt;</span> {</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
            <p>You can check that if we search for “Lola” or “Flores” we
            will get the same document, with the name “Lola Flores”, in
            both cases.</p>
            <h2 data-number="7.6" id="put"><span
            class="header-section-number">7.6</span> PUT</h2>
            <p>The <strong>PUT</strong> service is, in some way, a
            combination of <strong>GET</strong> and
            <strong>POST</strong>. As in the POST service, we will send
            in the body of the request the new data of the contact to be
            modified and the same middleware to get them. And, as in the
            GET by id service, we will pass as a parameter to the route
            the ID of the contact that we want to modify.</p>
            <p>We can use the <code>findByIdAndUpdate</code> method to
            complete the whole task.</p>
            <p>The code should be like this:</p>
            <div class="sourceCode" id="cb23"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>(<span class="st">&#39;/contact/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(req<span class="op">.</span><span class="at">body</span>) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">restaurant</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span>) {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        Contact<span class="op">.</span><span class="fu">findByIdAndUpdate</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">phone</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span><span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">age</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span><span class="op">,</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">favouriteRestaurant</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">restaurant</span><span class="op">,</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">pets</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span> {<span class="kw">new</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>          })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                <span class="dt">error</span><span class="op">:</span><span class="st">&quot;Error updating the contact&quot;</span>})<span class="op">;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Some parameter is missing&#39;</span>)<span class="op">;</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Invalid request body&#39;</span>)<span class="op">;</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <figure>
            <img src="images/image10.png" alt="PUT using the id" />
            <figcaption aria-hidden="true">PUT using the id</figcaption>
            </figure>
            <p>We can achieve the same result relying on the model
            validation:</p>
            <div class="sourceCode" id="cb24"><pre
            class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>(<span class="st">&#39;/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  Contact<span class="op">.</span><span class="fu">findByIdAndUpdate</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">$set</span><span class="op">:</span> {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          <span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>          <span class="dt">phone</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">phone</span><span class="op">,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>          <span class="dt">age</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">age</span><span class="op">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">favouriteRestaurant</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">favouriteRestaurant</span><span class="op">,</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>          <span class="dt">pets</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">pets</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> {<span class="kw">new</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">runValidators</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>          res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>          res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Contact not found&quot;</span>})<span class="op">;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                <span class="dt">error</span><span class="op">:</span><span class="st">&quot;Error updating contact: &quot;</span><span class="op">,</span> error})<span class="op">;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <p>Note the use of <code>runValidators</code> to use the
            validation (seen in the previous unit).</p>
            <h2 data-number="7.7" id="put-using-a-filter"><span
            class="header-section-number">7.7</span> PUT using a
            filter</h2>
            <p>If we want to update a document matching a condition, we
            will use <code>findOneAndUpdate()</code>. To update all the
            documents matching a condition, we will use
            <code>updateMany()</code>.</p>
            <p><a
            href="https://mongoosejs.com/docs/tutorials/findoneandupdate.html">How
            to use findOneAndUpdate() in Mongoose</a></p>
            <p>An example: let’s change the name of a contact. We will
            send both names (old and new) as parameters:</p>
            <div class="sourceCode" id="cb25"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">put</span>(<span class="st">&#39;/contact/name/:name/:newname&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">name</span> <span class="op">&amp;&amp;</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">newname</span>) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> filter <span class="op">=</span> {<span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">name</span>}<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> update <span class="op">=</span> {<span class="dt">name</span><span class="op">:</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">newname</span>}</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        Contact<span class="op">.</span><span class="fu">findOneAndUpdate</span>(filter<span class="op">,</span> update)<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> <span class="st">&quot;Name changed to &quot;</span><span class="op">+</span>req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">newname</span>})<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">error</span><span class="op">:</span><span class="st">&quot;Error updating the contact&quot;</span>})<span class="op">;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Some parameter is missing&#39;</span>)<span class="op">;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <figure>
            <img src="images/image11.png" alt="PUT using a filter" />
            <figcaption aria-hidden="true">PUT using a
            filter</figcaption>
            </figure>
            <p><a
            href="https://mongoosejs.com/docs/api/query.html#Query.prototype.updateMany()">How
            to use updateMany() in Mongoose</a></p>
            <h2 data-number="7.8" id="delete-a-document"><span
            class="header-section-number">7.8</span> DELETE a
            document</h2>
            <p>To delete contacts, we will use a URI similar to a
            contact get or update, but in this case associated with the
            DELETE command. We will pass as a parameter the ID of the
            contact to be deleted, and we will find and delete the
            contact with that id. We can use the method
            <code>findByIdAndDelete()</code>:</p>
            <p>In this case, we are going to delete a contact using its
            id.</p>
            <div class="sourceCode" id="cb26"><pre
            class="sourceCode js"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">delete</span>(<span class="st">&#39;/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    Contact<span class="op">.</span><span class="fu">findByIdAndDelete</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>)<span class="op">.</span><span class="fu">then</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (result)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">result</span><span class="op">:</span> result})<span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>               <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">error</span><span class="op">:</span> <span class="st">&quot;Contact not found&quot;</span>})<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">catch</span>(error <span class="kw">=&gt;</span> {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">send</span>({<span class="dt">ok</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">error</span><span class="op">:</span><span class="st">&quot;Error deleting contact&quot;</span>})<span class="op">;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
            <figure>
            <img src="images/image12.png" alt="DELETE by id" />
            <figcaption aria-hidden="true">DELETE by id</figcaption>
            </figure>
            <p>We can use another condition as a filter, but using the
            <code>findOneAndDelete</code> method to delete. However, the
            method <code>findOneAndDelete</code> only removes the first
            document matching the filter.</p>
        </main>
        

        <!--- Modal images -->

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- The Close Button -->
            <!--span class="close">&times;</span-->

            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="img01">

            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>

        <!-- End Modal Images -->

        <!-- Snackbar for copy code -->
        <div id="snackbar">Codi copiat!</div>
        <!-- End Snackbar -->

        <script>
            function ModalizeImages() {
                // Script basat en https://www.w3schools.com/howto/howto_css_modal_images.asp
                // PEr ampliar imatges en fer click

                // Get the modal
                var modal = document.getElementById("myModal");

                var modalImg = document.getElementById("img01");
                var captionText = document.getElementById("caption");

                // Get the image and insert it inside the modal - use its "alt" text as a caption
                //var img = document.getElementById("myImg");
                document.querySelectorAll("img").forEach((img => {
                        img.onclick = function() {
                            modal.style.display = "block";
                            modalImg.src = this.src;
                            captionText.innerHTML = this.alt;
                        }
                    }))
                    // Get the <span> element that closes the modal
                var span = document.getElementsByClassName("close")[0];

                // When the user clicks on <span> (x), close the modal
                //span.onclick = function() {
                myModal.onclick = function() {
                    modal.style.display = "none";
                }


            }


            function markItem(id) {
                // Restaurem format de tots
                document.querySelectorAll("#TOC a").forEach(function(item) {
                        //item.style.fontWeight = "300";
                        item.classList.remove("navItemSelected");
                    })
                    //item.style.color = "#ff0000";

                // Afegim format
                let items = document.querySelectorAll("#TOC a[href='#" + id + "']");
                items.forEach(function(item) {
                    //item.style.fontWeight = "bolder";
                    item.classList.add("navItemSelected");
                })

            }

            var observer = new IntersectionObserver(function(entries) {
                // isIntersecting is true when element and viewport are overlapping
                // isIntersecting is false when element and viewport don't overlap
                if (entries[0].isIntersecting === true) {
                    let id = entries[0].target.id;
                    markItem(id);
                }

            }, {
                threshold: [0]
            });

            window.addEventListener("load", function() {
                document.querySelectorAll("h1, h2, h3").forEach(function(item) {
                    observer.observe(item);
                });

                document.querySelectorAll("#TOC a").forEach(function(item) {
                    item.addEventListener("click", function(item) {
                        markItem(item.id);
                    })
                })

                // Fem modals totes les imatges
                ModalizeImages();
            })

            document.querySelector("#TOC").addEventListener("click", function(event) {
                let toc = event.target
                if (toc.offsetWidth > 10) {
                    toc.classList.add("minimizedToc");
                }
            })

            document.querySelector("#TOC").addEventListener("mouseover", function(event) {
                let toc = event.target
                if (toc.classList.contains("minimizedToc"))
                    toc.classList.remove("minimizedToc");
            })


                        
            /* PER COPIAR CODI */


            // Busca tots els elements amb la classe "sourceCode"
            var sourceCodeElements = document.querySelectorAll('div.sourceCode');

            /*Afegim el botó a tots els divs */
            // Afegir un botó per a cada element "sourceCode"
            sourceCodeElements.forEach(function(element) {
                console.log(element.id);
                var button = document.createElement('div');
                button.className = 'button-copy';

                // Afegir una icona al botó (fa servir FontAwesome com a exemple)
                //var icon = document.createElement('i');
                //icon.className = 'fas fa-copy'; // Utilitza l'ícona "copy" de FontAwesome

                // Obté l'ID de l'element actual
                var elementId = element.id;

                // Afegeix un event listener al botó per cridar la funció amb l'ID
                button.addEventListener('click', function() {
                    copyContent(elementId);
                });

                // Afegeix l'icona al botó i el botó just dins de l'element "sourceCode"
                //button.appendChild(icon);
                element.appendChild(button);
            });



            // Funció per copiar el contingut d'un element amb l'ID donat
            function copyContent(elementId) {
                var element = document.getElementById(elementId);
                var textToCopy = element.innerText;

                // Crea un element de text i copia el contingut
                var textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);

                // Selecciona i copia el text
                textArea.select();
                document.execCommand('copy');

                // Elimina l'element de text afegit temporalment
                document.body.removeChild(textArea);

                // Notifica a l'usuari que el codi s'ha copiat
                mostraSnackbar();
            }

            /* SNACKBAR EN COPIAR CODI */

            function mostraSnackbar() {
            // Busquem l'snackbar
            var x = document.getElementById("snackbar");

            // Li afegim la classe show
            x.className = "show";

            // I als tres segons la llevem
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            } 




        </script>
    </div>
</body>

</html>