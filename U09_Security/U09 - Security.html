<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-UK" xml:lang="en-UK" >

<head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />     <meta name="author" content="Fidel Oltra, Ricardo Sánchez" />        <title>Unit 9. Security.</title>
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        div.columns{display: flex; gap: min(4vw, 1.5em);}
        div.column{flex: auto; overflow-x: auto;}
        div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
        /* The extra [class] is a hack that increases specificity enough to
           override a similar rule in reveal.js */
        ul.task-list[class]{list-style: none;}
        ul.task-list li input[type="checkbox"] {
          font-size: inherit;
          width: 0.8em;
          margin: 0 0.8em 0.2em -1.6em;
          vertical-align: middle;
        }
        .display.math{display: block; text-align: center; margin: 0.5rem auto;}
        /* CSS for syntax highlighting */
        pre > code.sourceCode { white-space: pre; position: relative; }
        pre > code.sourceCode > span { line-height: 1.25; }
        pre > code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        pre > code.sourceCode { white-space: pre-wrap; }
<<<<<<< HEAD
        pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
=======
        pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
>>>>>>> refs/remotes/origin/main
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {  background-color: #f8f8f8; }
        @media screen {
        pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ef2929; } /* Alert */
        code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
        code span.at { color: #204a87; } /* Attribute */
        code span.bn { color: #0000cf; } /* BaseN */
        code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
        code span.ch { color: #4e9a06; } /* Char */
        code span.cn { color: #8f5902; } /* Constant */
        code span.co { color: #8f5902; font-style: italic; } /* Comment */
        code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
        code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
        code span.dt { color: #204a87; } /* DataType */
        code span.dv { color: #0000cf; } /* DecVal */
        code span.er { color: #a40000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.fl { color: #0000cf; } /* Float */
        code span.fu { color: #204a87; font-weight: bold; } /* Function */
        code span.im { } /* Import */
        code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
        code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
        code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
        code span.ot { color: #8f5902; } /* Other */
        code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
        code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
        code span.ss { color: #4e9a06; } /* SpecialString */
        code span.st { color: #4e9a06; } /* String */
        code span.va { color: #000000; } /* Variable */
        code span.vs { color: #4e9a06; } /* VerbatimString */
        code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
        <link rel="stylesheet" href="../web_template/aqua.css" />  
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
      
</head>

<body>
    <div id="content">
                 <header id="title-block-header">
            <h1 class="title">Unit 9. Security.</h1>
            <!---->
            <!--         <p class="author">Fidel Oltra, Ricardo
Sánchez</p>
         -->
                    </header>
                 <nav id="TOC" role="doc-toc">
            <div class="navContainer">
                                <h2 id="toc-title">Index</h2>
                 <ul>
<li><a href="#security" id="toc-security"><span
class="toc-section-number">1</span> Security</a></li>
<li><a href="#managing-users" id="toc-managing-users"><span
class="toc-section-number">2</span> Managing users</a>
<ul>
<li><a href="#login-class" id="toc-login-class"><span
class="toc-section-number">2.1</span> Login class</a></li>
<li><a href="#login-repository" id="toc-login-repository"><span
class="toc-section-number">2.2</span> Login repository</a></li>
<li><a href="#register" id="toc-register"><span
class="toc-section-number">2.3</span> Register</a></li>
<li><a href="#login" id="toc-login"><span
class="toc-section-number">2.4</span> Login</a></li>
<<<<<<< HEAD
<li><a href="#tracking-user-and-logging-out"
id="toc-tracking-user-and-logging-out"><span
class="toc-section-number">2.5</span> Tracking user and logging
out</a></li>
<li><a href="#permissions" id="toc-permissions"><span
class="toc-section-number">2.6</span> Permissions</a></li>
=======
<li><a href="#view-registered-users"
id="toc-view-registered-users"><span
class="toc-section-number">2.5</span> View registered users</a></li>
<li><a href="#tracking-user-and-logging-out"
id="toc-tracking-user-and-logging-out"><span
class="toc-section-number">2.6</span> Tracking user and logging
out</a></li>
<li><a href="#permissions" id="toc-permissions"><span
class="toc-section-number">2.7</span> Permissions</a></li>
>>>>>>> refs/remotes/origin/main
</ul></li>
</ul>
            </div>
        </nav>
                <main>
            <h1 data-number="1" id="security"><span
            class="header-section-number">1</span> Security</h1>
            <p>In this unit we’ll see how to apply basic security to our
            application. There are 2 main mechanism of security:</p>
            <ul>
            <li><strong>Authentication</strong>: how the users can
            access the app and where their credentials are stored.</li>
            <li><strong>Authorization</strong>: once the user has been
            logged in correctly, determine their
            <strong>permissions</strong> and what resources can access
            and which can’t.</li>
            </ul>
            <p>In this unit we will use the Provider App of the previous
            examples to show how to do all the stuff. We will use the
            next scripts:</p>
            <ul>
<<<<<<< HEAD
            <li><code>provider_form.php</code>: the existent script,
            used to manage providers.</li>
=======
>>>>>>> refs/remotes/origin/main
            <li><code>register_form.php</code>: a new script to
            auto-register users.</li>
            <li><code>login_form.php</code>: a new script to log in the
            users.</li>
<<<<<<< HEAD
=======
            <li><code>login_list.php</code>: a new script to view the
            registered users.</li>
>>>>>>> refs/remotes/origin/main
            </ul>
            <h1 data-number="2" id="managing-users"><span
            class="header-section-number">2</span> Managing users</h1>
            <p>To implement the user’s authentication in our app, we
            need two more forms, one for registering and another one for
            logging and a class for managing and storing logins.</p>
            <h2 data-number="2.1" id="login-class"><span
            class="header-section-number">2.1</span> Login class</h2>
            <p>The Login class represents a user, identified by their
            email and password. The properties are:</p>
            <ul>
            <li>id: an integer for identifying the user in the
            database.</li>
            <li>email: a string with email format.</li>
            <li>password: a string with at least 8 characters.</li>
            </ul>
            <p>We also need a function to validate the login’s data.</p>
            <p>The code for the Login class is as follows:</p>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">declare</span>(strict_types<span class="op">=</span><span class="dv">1</span>)<span class="ot">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<<<<<<< HEAD
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Login</span>
=======
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">L</span>ogin</span>
>>>>>>> refs/remotes/origin/main
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> <span class="va">$id</span><span class="ot">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">string</span> <span class="va">$email</span><span class="ot">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">string</span> <span class="va">$password</span><span class="ot">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> <span class="bu">__construct</span>()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;id <span class="op">=</span> <span class="dv">0</span><span class="ot">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;email <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;password <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Getters and setters ...</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> validate()<span class="ot">:</span> <span class="dt">array</span> {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$this</span>-&gt;email)){</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&#39;Email is required&#39;</span><span class="ot">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">elseif</span> (<span class="op">!</span><span class="fu">filter_var</span>(<span class="va">$this</span>-&gt;email<span class="ot">,</span> <span class="cn">FILTER_VALIDATE_EMAIL</span>)){</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&#39;Email is not valid&#39;</span><span class="ot">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="kw">empty</span>(<span class="va">$this</span>-&gt;password)){</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="va">$errors</span>[<span class="st">&#39;password&#39;</span>] <span class="op">=</span> <span class="st">&#39;Password is required&#39;</span><span class="ot">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">elseif</span> (<span class="fu">strlen</span>(<span class="va">$this</span>-&gt;password) <span class="op">&lt;</span> <span class="dv">8</span>){</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">$errors</span>[<span class="st">&#39;password&#39;</span>] <span class="op">=</span> <span class="st">&#39;Password must be at least 8 characters&#39;</span><span class="ot">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$errors</span><span class="ot">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="2.2" id="login-repository"><span
            class="header-section-number">2.2</span> Login
            repository</h2>
            <p>In order to store our logins in the database, we also
            need a repository with the basic CRUD operations:</p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">declare</span>(strict_types<span class="op">=</span><span class="dv">1</span>)<span class="ot">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/Login.php&#39;</span><span class="ot">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/DBConnection.php&#39;</span><span class="ot">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/IDbAccess.php&#39;</span><span class="ot">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<<<<<<< HEAD
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoginRepository <span class="kw">implements</span> IDbAccess</span>
=======
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">L</span>oginRepository <span class="kw">implements</span> <span class="cn">I</span>DbAccess</span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> getAll()<span class="ot">:</span> <span class="ot">?</span><span class="dt">array</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<<<<<<< HEAD
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;SELECT * FROM login&quot;</span>)<span class="ot">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;setFetchMode(<span class="bu">PDO</span>::<span class="cn">FETCH_CLASS</span><span class="op">|</span><span class="bu">PDO</span>::<span class="cn">FETCH_PROPS_LATE</span><span class="ot">,</span> <span class="st">&#39;Login&#39;</span>)<span class="ot">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;execute()<span class="ot">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$stmt</span>-&gt;fetchAll()<span class="ot">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<<<<<<< HEAD
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> select(<span class="va">$id</span>) <span class="ot">:</span> <span class="ot">?</span>Login</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> select(<span class="va">$id</span>) <span class="ot">:</span> <span class="ot">?</span><span class="cn">L</span>ogin</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;SELECT * FROM login WHERE id = :id&quot;</span>)<span class="ot">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;setFetchMode(<span class="bu">PDO</span>::<span class="cn">FETCH_CLASS</span><span class="op">|</span><span class="bu">PDO</span>::<span class="cn">FETCH_PROPS_LATE</span><span class="ot">,</span> <span class="st">&#39;Login&#39;</span>)<span class="ot">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;execute([<span class="st">&#39;id&#39;</span> =&gt; <span class="va">$id</span>])<span class="ot">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> <span class="va">$stmt</span>-&gt;fetch()<span class="ot">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">$login</span>) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">$login</span><span class="ot">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> insert(<span class="va">$object</span>) <span class="ot">:</span> <span class="kw">false</span> <span class="op">|</span> <span class="dt">string</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    {</span>
<<<<<<< HEAD
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;INSERT INTO login (id, email, password) VALUES (:id, :email, :password)&quot;</span>)<span class="ot">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;execute([</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;id&#39;</span> =&gt; <span class="kw">null</span><span class="ot">,</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;email&#39;</span> =&gt; <span class="va">$object</span>-&gt;getEmail()<span class="ot">,</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;password&#39;</span> =&gt; <span class="va">$object</span>-&gt;getPassword()</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            ])<span class="ot">;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$conn</span>-&gt;lastInsertId()<span class="ot">;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> delete(<span class="va">$object</span>) <span class="ot">:</span> <span class="dt">int</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    {</span>
<<<<<<< HEAD
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;DELETE FROM login WHERE id = :id&quot;</span>)<span class="ot">;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;execute([<span class="st">&#39;id&#39;</span> =&gt; <span class="va">$object</span>-&gt;getId()])<span class="ot">;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$stmt</span>-&gt;rowCount()<span class="ot">;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="ot">;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> update(<span class="va">$object</span>) <span class="ot">:</span> <span class="dt">int</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    {</span>
<<<<<<< HEAD
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;UPDATE login SET email = :email, password = :password WHERE id = :id&quot;</span>)<span class="ot">;</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>            <span class="va">$stmt</span>-&gt;execute([</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;id&#39;</span> =&gt; <span class="va">$object</span>-&gt;getId()<span class="ot">,</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;email&#39;</span> =&gt; <span class="va">$object</span>-&gt;getEmail()<span class="ot">,</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;password&#39;</span> =&gt; <span class="va">$object</span>-&gt;getPassword()</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>            ])<span class="ot">;</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$stmt</span>-&gt;rowCount()<span class="ot">;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="ot">;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>We also need a new table in the database with the
            required fields:</p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> `providers`.`login` (`id` <span class="dt">INT</span> <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT , `email` <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> , `password` <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> , <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (`id`)) ENGINE <span class="op">=</span> InnoDB; </span></code></pre></div>
            <p>The new table description:</p>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DESCRIBE login;</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>| Field    | <span class="kw">Type</span>         | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>| <span class="kw">id</span>       | <span class="dt">int</span>(<span class="dv">11</span>)      | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>| email    | <span class="dt">varchar</span>(<span class="dv">100</span>) | <span class="kw">NO</span>   |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>| <span class="kw">password</span> | <span class="dt">varchar</span>(<span class="dv">100</span>) | <span class="kw">NO</span>   |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span></code></pre></div>
            <h2 data-number="2.3" id="register"><span
            class="header-section-number">2.3</span> Register</h2>
            <p>We are going to make a registration form. Make a new
            script called <code>register_form.php</code> with the
            registration code. We don’t need the <code>id</code> field
            and only need a ‘Register’ button. Also, make sure that the
            password field is of type <strong>password</strong> (let the
            email field of type text to check the server
            validation):</p>
            <figure>
            <img src="images/u09-01.png" width="350"
            alt="Register form" />
            <figcaption aria-hidden="true">Register form</figcaption>
            </figure>
            <p>When the ‘Register’ button is pressed, we send the data
            to the same form with the POST method to do the required
            validations. But here we add an additional check: if the
            email already exists in the database, we show a new error
            message:</p>
            <figure>
            <img src="images/u09-02.png" width="350"
            alt="Existent email" />
            <figcaption aria-hidden="true">Existent email</figcaption>
            </figure>
            <p>To do this check, we add the needed code to the form
<<<<<<< HEAD
            after the basic validation:</p>
=======
            script after the basic validation:</p>
>>>>>>> refs/remotes/origin/main
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">$errors</span> <span class="op">=</span> <span class="va">$login</span>-&gt;validate()<span class="ot">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<<<<<<< HEAD
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>) <span class="op">&amp;&amp;</span> LoginRepository::searchByEmail(<span class="va">$login</span>) <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
=======
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>) <span class="op">&amp;&amp;</span> <span class="cn">L</span>oginRepository::searchByEmail(<span class="va">$login</span>) <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
>>>>>>> refs/remotes/origin/main
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">$errors</span>[<span class="st">&#39;email&#39;</span>] <span class="op">=</span> <span class="st">&quot;* Email already exists&quot;</span><span class="ot">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>We also need to create a new static method in the
            <code>LoginRepository</code> class for searching an existent
            email, the <code>searchByEmail</code> method:</p>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> searchByEmail(<span class="va">$object</span>)<span class="ot">:</span> <span class="dt">int</span> {</span>
<<<<<<< HEAD
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
=======
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;SELECT email FROM login WHERE email=:email&quot;</span>)<span class="ot">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span>-&gt;execute([<span class="st">&#39;email&#39;</span>=&gt;<span class="va">$object</span>-&gt;getEmail()])<span class="ot">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$stmt</span>-&gt;rowCount()<span class="ot">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="ot">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>Once all the validation is passed, we add the new login
            and password to the database, but before, we need to hash
            the password using the functions of the Unit 6 point 7:</p>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>)) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_POST</span>[<span class="st">&#39;submit&#39;</span>]) ){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">//New login</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span>-&gt;setPassword(<span class="fu">password_hash</span>(<span class="va">$login</span>-&gt;getPassword()<span class="ot">,</span> <span class="cn">PASSWORD_DEFAULT</span>))<span class="ot">;</span></span>
<<<<<<< HEAD
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            LoginRepository::insert(<span class="va">$login</span>)<span class="ot">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Register successful&quot;</span><span class="ot">;</span><span class="co">//If no errors, make a new empty login to clear the fields</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> <span class="kw">new</span> Login()<span class="ot">;</span></span>
=======
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="cn">L</span>oginRepository::insert(<span class="va">$login</span>)<span class="ot">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Register successful&quot;</span><span class="ot">;</span><span class="co">//If no errors, make a new empty login to clear the fields</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">L</span>ogin()<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (<span class="bu">Exception</span> <span class="va">$e</span>) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">echo</span> <span class="st">&quot;Error registering user: &quot;</span> <span class="op">.</span> <span class="va">$e</span>-&gt;getMessage()<span class="ot">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>If you query the database, you can see the new login
            hashed:</p>
<<<<<<< HEAD
            <pre><code>select * from login;
+----+----------------+--------------------------------------------------------------+
| id | email          | password                                                     |
+----+----------------+--------------------------------------------------------------+
|  1 | admin@mail.com | $2y$10$ET9Sj8II1XDQpIYBN4RQ9.lQ9IsdYhrTMcUpOwkXcCaMVEudduDoq |
+----+----------------+--------------------------------------------------------------+</code></pre>
            <h2 data-number="2.4" id="login"><span
            class="header-section-number">2.4</span> Login</h2>
            <p>Once a user is registered, it need a login form to be
=======
            <figure>
            <img src="images/u09-07.png" alt="New login stored" />
            <figcaption aria-hidden="true">New login stored</figcaption>
            </figure>
            <h2 data-number="2.4" id="login"><span
            class="header-section-number">2.4</span> Login</h2>
            <p>Once a user is registered, it needs a login form to be
>>>>>>> refs/remotes/origin/main
            authenticated. We will create the
            <code>login_form.php</code> script to do that:</p>
            <figure>
            <img src="images/u09-04.png" width="350" alt="Login form" />
            <figcaption aria-hidden="true">Login form</figcaption>
            </figure>
            <p>In this form, once the basic validation is done, we need
            to check if both the email and password exist and are
            correct. If they don’t match, we show only an error message
            for security reasons. First of all, let’s create a new
            method in <code>LoginRepository</code> to check if the
            stored credentials are valid, using the
            <code>password_verify</code> method seen on Unit 6:</p>
<<<<<<< HEAD
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> checkCredential(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$object</span>)<span class="ot">:</span> <span class="dt">bool</span><span class="op">|</span><span class="dt">int</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$conn</span> <span class="op">=</span> DBConnection::connectDB()<span class="ot">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;SELECT * FROM logins WHERE email=:email&quot;</span>)<span class="ot">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span>-&gt;setFetchMode(<span class="bu">PDO</span>::<span class="cn">FETCH_CLASS</span> <span class="op">|</span> <span class="bu">PDO</span>::<span class="cn">FETCH_PROPS_LATE</span><span class="ot">,</span> <span class="st">&#39;Login&#39;</span>)<span class="ot">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span>-&gt;execute([<span class="st">&#39;email&#39;</span>=&gt;<span class="va">$object</span>-&gt;getEmail()])<span class="ot">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$login</span> <span class="op">=</span> <span class="va">$stmt</span>-&gt;fetch()<span class="ot">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="va">$login</span> <span class="op">&amp;&amp;</span> <span class="fu">password_verify</span>(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$login</span>-&gt;getPassword())){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Returns the id login if successful</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$login</span>-&gt;getId()<span class="ot">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
=======
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">function</span> checkCredential(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$object</span>)<span class="ot">:</span> <span class="dt">bool</span><span class="op">|</span><span class="dt">int</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$conn</span> <span class="op">=</span> <span class="cn">D</span>BConnection::connectDB()<span class="ot">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$conn</span>)) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span> <span class="op">=</span> <span class="va">$conn</span>-&gt;prepare(<span class="st">&quot;SELECT * FROM logins WHERE email=:email&quot;</span>)<span class="ot">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span>-&gt;setFetchMode(<span class="bu">PDO</span>::<span class="cn">FETCH_CLASS</span> <span class="op">|</span> <span class="bu">PDO</span>::<span class="cn">FETCH_PROPS_LATE</span><span class="ot">,</span> <span class="st">&#39;Login&#39;</span>)<span class="ot">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">$stmt</span>-&gt;execute([<span class="st">&#39;email&#39;</span>=&gt;<span class="va">$object</span>-&gt;getEmail()])<span class="ot">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$login</span> <span class="op">=</span> <span class="va">$stmt</span>-&gt;fetch()<span class="ot">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="va">$login</span> <span class="op">&amp;&amp;</span> <span class="fu">password_verify</span>(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$login</span>-&gt;getPassword())){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Returns the id login if successful</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$login</span>-&gt;getId()<span class="ot">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
>>>>>>> refs/remotes/origin/main
            <p>Then, in <code>login_form.php</code>, use the new method
            to check if the credentials match those stored in the DB. If
            they are, store the user’s id in a session variable in order
            to know in other pages if the user is authenticated
            (remember to call <code>session_start()</code> at the
            beginning of the script) and redirect to the
            <code>provider_list.php</code> script:</p>
<<<<<<< HEAD
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>)) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_POST</span>[<span class="st">&#39;submit&#39;</span>]) ){</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="va">$idLogin</span> <span class="op">=</span> LoginRepository::checkCredential(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$login</span>)<span class="ot">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">$idLogin</span>){</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Login successful&quot;</span><span class="ot">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                <span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>] <span class="op">=</span> <span class="va">$idLogin</span><span class="ot">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">header</span>(<span class="st">&#39;Location: provider_list.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Login failed&quot;</span><span class="ot">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> <span class="kw">new</span> Login()<span class="ot">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (<span class="bu">Exception</span> <span class="va">$e</span>) {</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">echo</span> <span class="st">&quot;Error checking login: &quot;</span> <span class="op">.</span> <span class="va">$e</span>-&gt;getMessage()<span class="ot">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="2.5"
            id="tracking-user-and-logging-out"><span
            class="header-section-number">2.5</span> Tracking user and
=======
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">empty</span>(<span class="va">$errors</span>)) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_POST</span>[<span class="st">&#39;submit&#39;</span>]) ){</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="va">$idLogin</span> <span class="op">=</span> <span class="cn">L</span>oginRepository::checkCredential(<span class="va">$clearPassword</span><span class="ot">,</span> <span class="va">$login</span>)<span class="ot">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="va">$idLogin</span>){</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Login successful&quot;</span><span class="ot">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>] <span class="op">=</span> <span class="va">$idLogin</span><span class="ot">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">header</span>(<span class="st">&#39;Location: provider_list.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                <span class="va">$opMsg</span> <span class="op">=</span> <span class="st">&quot;Login failed&quot;</span><span class="ot">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">L</span>ogin()<span class="ot">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (<span class="bu">Exception</span> <span class="va">$e</span>) {</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">echo</span> <span class="st">&quot;Error checking login: &quot;</span> <span class="op">.</span> <span class="va">$e</span>-&gt;getMessage()<span class="ot">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="2.5" id="view-registered-users"><span
            class="header-section-number">2.5</span> View registered
            users</h2>
            <p>Optionally, we can do a view to show a list with the
            registered users, similar to the one of the unit 4 for the
            providers. We will name the script
            <code>login_list.php</code>. The code is pretty similar to
            the providers list view:</p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">session_start</span>()<span class="ot">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/classes/Login.php&#39;</span><span class="ot">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/classes/LoginRepository.php&#39;</span><span class="ot">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="va">$logins</span> <span class="op">=</span> <span class="cn">L</span>oginRepository::getAll()<span class="ot">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> <span class="cn">L</span>oginRepository::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">?&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>table<span class="op">&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>tr<span class="op">&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>th<span class="op">&gt;</span><span class="cn">ID</span><span class="op">&lt;/</span>th<span class="op">&gt;</span> <span class="op">&lt;</span>th<span class="op">&gt;</span><span class="cn">E</span>mail<span class="op">&lt;/</span>th<span class="op">&gt;</span> <span class="op">&lt;</span>th<span class="op">&gt;</span><span class="cn">P</span>assword<span class="op">&lt;/</span>th<span class="op">&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>tr<span class="op">&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span><span class="ot">?</span>php</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">foreach</span> (<span class="va">$logins</span> <span class="kw">as</span> <span class="va">$login</span>){</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">echo</span> <span class="st">&quot;    &lt;tr&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="ot">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">echo</span> <span class="st">&quot; &lt;td&gt; &quot;</span> <span class="op">.</span> <span class="va">$login</span>-&gt;getId() <span class="op">.</span> <span class="st">&quot;&lt;/td&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">echo</span> <span class="st">&quot; &lt;td&gt; &quot;</span> <span class="op">.</span> <span class="va">$login</span>-&gt;getEmail() <span class="op">.</span> <span class="st">&quot;&lt;/td&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">echo</span> <span class="st">&quot; &lt;td&gt; &quot;</span> <span class="op">.</span> <span class="va">$login</span>-&gt;getPassword() <span class="op">.</span> <span class="st">&quot;&lt;/td&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">echo</span> <span class="st">&quot;    &lt;/tr&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="ot">;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">?&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>table<span class="op">&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <figure>
            <img src="images/u09-06.png" alt="Login list" />
            <figcaption aria-hidden="true">Login list</figcaption>
            </figure>
            <h2 data-number="2.6"
            id="tracking-user-and-logging-out"><span
            class="header-section-number">2.6</span> Tracking user and
>>>>>>> refs/remotes/origin/main
            logging out</h2>
            <p>Once the user is authenticated, we can check if it is
            logged in on each script using the session variable
            <code>'user_id'</code>. Make a new partial, named
            <code>nav_bar.part.php</code> to be included at the top of
<<<<<<< HEAD
            each page with that shows the user’s email:</p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/../models/Login.php&#39;</span><span class="ot">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/../models/LoginDao.php&#39;</span><span class="ot">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="va">$welcomeMessage</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> LoginDao::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$user</span>)) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$userEmail</span> <span class="op">=</span> LoginDao::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])-&gt;getEmail() <span class="op">??</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
=======
            each page that shows the user’s email:</p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/../classes/Login.php&#39;</span><span class="ot">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">require_once</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/../classes/LoginRepository.php&#39;</span><span class="ot">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="va">$welcomeMessage</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> <span class="cn">L</span>oginRepository::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="fu">is_null</span>(<span class="va">$user</span>)) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$userEmail</span> <span class="op">=</span> <span class="cn">L</span>oginRepository::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])-&gt;getEmail() <span class="op">??</span> <span class="st">&#39;&#39;</span><span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$welcomeMessage</span> <span class="op">=</span> <span class="st">&quot;Welcome </span><span class="va">$userEmail</span><span class="st">&quot;</span><span class="ot">;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">?&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> nav_bar<span class="op">.</span>part<span class="op">.</span>php <span class="op">-</span>-&gt;</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>nav<span class="op">&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span<span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$welcomeMessage</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>nav<span class="op">&gt;</span></span></code></pre></div>
<<<<<<< HEAD
            <p>Then, include it in <code>login_form.php</code> and in
=======
            <p>Then, include it in all the pages:
            <code>provider_list.php</code>,
            <code>provider_form.php</code>, and in
>>>>>>> refs/remotes/origin/main
            <code>login_list.php</code> (remember to call
            <code>session_start()</code> at the beginning of the
            script):</p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// login_form.php</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>body<span class="op">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="ot">?</span>php <span class="kw">include</span> <span class="cn">__DIR__</span> <span class="op">.</span> <span class="st">&#39;/partials/nav_bar.part.php&#39;</span><span class="ot">;</span> <span class="kw">?&gt;</span></span>
<<<<<<< HEAD
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>h1<span class="op">&gt;</span>Edit login<span class="op">&lt;/</span>h1<span class="op">&gt;</span></span></code></pre></div>
            <p>In <code>login_form.php</code>, we can get the login data
            using the <code>id</code> and, then, pass it to the
            form:</p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Read id from login_list</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="va">$_SERVER</span>[<span class="st">&#39;REQUEST_METHOD&#39;</span>] <span class="op">==</span> <span class="st">&quot;GET&quot;</span>) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">empty</span>(<span class="va">$_REQUEST</span>[<span class="st">&quot;id&quot;</span>])) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$login</span> <span class="op">=</span> LoginDao::select(<span class="va">$_REQUEST</span>[<span class="st">&#39;id&#39;</span>])<span class="ot">;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Read id from session</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])){</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            <span class="va">$login</span> <span class="op">=</span> LoginDao::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>The next step is to implement a method to logging out the
            user. In <code>nav_bar.part.php</code> add a link only if
            the user is authenticated:</p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> nav_bar<span class="op">.</span>part<span class="op">.</span>php <span class="op">-</span>-&gt;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>nav<span class="op">&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span<span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$welcomeMessage</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;</span> <span class="op">|</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span<span class="op">&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span><span class="ot">?</span>php</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">echo</span> <span class="st">&quot;&lt;a href=&#39;logout.php&#39;&gt;Logout&lt;/a&gt;&quot;</span><span class="ot">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">?&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>nav<span class="op">&gt;</span></span></code></pre></div>
            <p>The target, <code>logout.php</code>, simply deletes the
            session variable and redirect to the login access form:</p>
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">session_start</span>()<span class="ot">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">unset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&#39;Location: login_access_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="2.6" id="permissions"><span
            class="header-section-number">2.6</span> Permissions</h2>
=======
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>h1<span class="op">&gt;</span><span class="cn">E</span>dit login<span class="op">&lt;/</span>h1<span class="op">&gt;</span></span></code></pre></div>
            <p>The next step is to implement a method to logging out the
            user. In <code>nav_bar.part.php</code> add a link only if
            the user is authenticated:</p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> nav_bar<span class="op">.</span>part<span class="op">.</span>php <span class="op">-</span>-&gt;</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>nav<span class="op">&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span<span class="op">&gt;</span> <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="va">$welcomeMessage</span> <span class="kw">?&gt;</span> <span class="op">&lt;/</span>span<span class="op">&gt;</span> <span class="op">|</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>span<span class="op">&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span><span class="ot">?</span><span class="op">=</span> <span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>]) <span class="ot">?</span> <span class="st">&quot;&lt;a href=&#39;logout.php&#39;&gt;Logout&lt;/a&gt;&quot;</span> <span class="ot">:</span> <span class="st">&quot;&quot;</span> <span class="kw">?&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>span<span class="op">&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>nav<span class="op">&gt;</span></span></code></pre></div>
            <p>The target, <code>logout.php</code>, simply deletes the
            session variable and redirect to the login form:</p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">session_start</span>()<span class="ot">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">unset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&#39;Location: login_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <h2 data-number="2.7" id="permissions"><span
            class="header-section-number">2.7</span> Permissions</h2>
>>>>>>> refs/remotes/origin/main
            <p>To establish an authorization system, we need each user
            to having a role. Each role will determine which pages and
            actions can the user do.</p>
            <p>For our application, we are going to establish 3
            different roles:</p>
            <ul>
            <li>Unauthenticated users: can only visit the login and
            register pages.</li>
<<<<<<< HEAD
            <li>Users with the role <strong>‘user’</strong>: can edit
            their own user data in the <code>login_form.php</code>
            script, but cannot access to the <code>logins_list</code>
            page.</li>
            <li>Users with the role <strong>‘admin’</strong>: can acces
            to the <code>login_list.php</code> page and edit all the
            users data in <code>login_form.php</code>.</li>
=======
            <li>Users with the role <strong>‘user’</strong>: can view
            all the providers in <code>provider_list.php</code>, but
            cannot access to the rest of the pages.</li>
            <li>Users with the role <strong>‘admin’</strong>: can acces
            to all the page and edit the providers data in
            <code>provider_form.php</code>.</li>
>>>>>>> refs/remotes/origin/main
            </ul>
            <p>Before coding, we need another field in our logins table
            to store the role. You can create it with phpMyAdmin or
            executing this SQL statement:</p>
<<<<<<< HEAD
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cn">ALTER</span> <span class="cn">TABLE</span> <span class="st">`logins`</span> <span class="cn">ADD</span> <span class="st">`role`</span> <span class="cn">VARCHAR</span>(<span class="dv">20</span>) <span class="kw">NULL</span> <span class="cf">DEFAULT</span> <span class="st">&#39;user&#39;</span><span class="ot">;</span> </span></code></pre></div>
=======
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cn">ALTER</span> <span class="cn">TABLE</span> <span class="st">`login`</span> <span class="cn">ADD</span> <span class="st">`role`</span> <span class="cn">VARCHAR</span>(<span class="dv">20</span>) <span class="kw">NULL</span> <span class="cf">DEFAULT</span> <span class="st">&#39;user&#39;</span><span class="ot">;</span> </span></code></pre></div>
>>>>>>> refs/remotes/origin/main
            <p>The default role will be ‘user’. We are allowing null
            data, so the existing users will be equivalent to users with
            the role ‘user’.</p>
            <p>Go to the register form and create a new user for the
            admin role. Inspect your database and verify that has the
            role <code>'user'</code>. Change it to
            <code>'admin'</code>:</p>
            <figure>
            <img src="images/u09-05.png"
            alt="admin user in phpMyAdmin" />
            <figcaption aria-hidden="true">admin user in
            phpMyAdmin</figcaption>
            </figure>
            <p>Make sure you have another user with the role ‘user’. Now
            we can change the permissions in each page.</p>
            <p>In addition, we need a new property in our
            <code>Login</code> class with the name <code>'role'</code>
            and their setter and getter:</p>
<<<<<<< HEAD
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> <span class="va">$role</span><span class="ot">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> getRole()<span class="ot">:</span> <span class="dt">string</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">$this</span>-&gt;role<span class="ot">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> setRole(<span class="dt">string</span> <span class="va">$role</span>)<span class="ot">:</span> <span class="dt">void</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;role <span class="op">=</span> <span class="va">$role</span><span class="ot">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>Also, add the necessary code to the
            <code>LoginRepository</code> class to store and retrieve the
            new field.</p>
            <p>In <code>logins_list.php</code>, simply add a check in
            the beginning of the script. If the user is authenticated
            but doesn’t has the admin role, redirect it to
            <code>login_form.php</code>. If the user is not
            authenticated, redirect to
            <code>login_access_form.php</code>:</p>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> LoginDao::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
=======
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">string</span> <span class="va">$role</span><span class="ot">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> getRole()<span class="ot">:</span> <span class="dt">string</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">$this</span>-&gt;role<span class="ot">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> setRole(<span class="dt">string</span> <span class="va">$role</span>)<span class="ot">:</span> <span class="dt">void</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;role <span class="op">=</span> <span class="va">$role</span><span class="ot">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>Also, add the necessary code to the
            <code>LoginRepository</code> class to store and retrieve the
            new field.</p>
            <p>In <code>provider_list.php</code> we check if exists the
            <code>user_id</code> session variable. If not, redirect to
            the login view:</p>
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&#39;Location: login_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>In <code>login_list.php</code>, simply add a check at the
            beginning of the script. If the user is authenticated but
            doesn’t has the admin role, redirect it to
            <code>provider_list.php</code>. If the user is not
            authenticated, redirect to <code>login_form.php</code>:</p>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> <span class="cn">L</span>oginDao::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
>>>>>>> refs/remotes/origin/main
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">$userRole</span> <span class="op">=</span> <span class="va">$user</span>-&gt;getRole()<span class="ot">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="va">$userRole</span> <span class="op">!=</span> <span class="st">&#39;admin&#39;</span>){</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Has the role user</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">header</span>(<span class="st">&#39;Location: login_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//No authenticated user</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&#39;Location: login_access_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<<<<<<< HEAD
            <p>Go to the <code>login_form.php</code>. In this form the
            admin users can view and change all the users data, but the
            normal users only can view and change their own data. To do
            that, simply add a new condition to the code to check the
            user’s id (remember that a user can change the query string
            in the browser):</p>
            <div class="sourceCode" id="cb19"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="kw">isset</span>(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">$user</span> <span class="op">=</span> LoginRepository::select(<span class="va">$_SESSION</span>[<span class="st">&#39;user_id&#39;</span>])<span class="ot">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">$userRole</span> <span class="op">=</span> <span class="va">$user</span>-&gt;getRole()<span class="ot">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="va">$userRole</span> <span class="op">!=</span> <span class="st">&#39;admin&#39;</span> <span class="op">&amp;&amp;</span> <span class="va">$login</span>-&gt;getId() <span class="op">!=</span> <span class="va">$user</span>-&gt;getId()){</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Has the role user and the same id</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">header</span>(<span class="st">&#39;Location: provider_list.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//No authenticated user</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">header</span>(<span class="st">&#39;Location: login_form.php&#39;</span>)<span class="ot">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>There are a lot of things to improve, like adding the
            possibility to change the user’s role or a mechanism to
            change the user’s password correctly. You can do it as
            exercise.</p>
            <p>Get the full app code in the <a
            href="https://github.com/ricardoprofe/login-security">GitHub
=======
            <p>Do the same in <code>provider_form.php</code>.</p>
            <p>There are a lot of things to improve, like adding the
            possibility to change the user’s role or a mechanism to
            change the user’s password correctly, even protect the api.
            You can do it as exercise.</p>
            <p>Get the full app code in the <a
            href="https://github.com/ricardoprofe/providers_sample_DWES_24_25_u9">GitHub
>>>>>>> refs/remotes/origin/main
            repo</a>.</p>
        </main>
        

        <!--- Modal images -->

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- The Close Button -->
            <!--span class="close">&times;</span-->

            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="img01">

            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>

        <!-- End Modal Images -->

        <!-- Snackbar for copy code -->
        <div id="snackbar">Codi copiat!</div>
        <!-- End Snackbar -->

        <script>
            function ModalizeImages() {
                // Script basat en https://www.w3schools.com/howto/howto_css_modal_images.asp
                // PEr ampliar imatges en fer click

                // Get the modal
                var modal = document.getElementById("myModal");

                var modalImg = document.getElementById("img01");
                var captionText = document.getElementById("caption");

                // Get the image and insert it inside the modal - use its "alt" text as a caption
                //var img = document.getElementById("myImg");
                document.querySelectorAll("img").forEach((img => {
                        img.onclick = function() {
                            modal.style.display = "block";
                            modalImg.src = this.src;
                            captionText.innerHTML = this.alt;
                        }
                    }))
                    // Get the <span> element that closes the modal
                var span = document.getElementsByClassName("close")[0];

                // When the user clicks on <span> (x), close the modal
                //span.onclick = function() {
                myModal.onclick = function() {
                    modal.style.display = "none";
                }


            }


            function markItem(id) {
                // Restaurem format de tots
                document.querySelectorAll("#TOC a").forEach(function(item) {
                        //item.style.fontWeight = "300";
                        item.classList.remove("navItemSelected");
                    })
                    //item.style.color = "#ff0000";

                // Afegim format
                let items = document.querySelectorAll("#TOC a[href='#" + id + "']");
                items.forEach(function(item) {
                    //item.style.fontWeight = "bolder";
                    item.classList.add("navItemSelected");
                })

            }

            var observer = new IntersectionObserver(function(entries) {
                // isIntersecting is true when element and viewport are overlapping
                // isIntersecting is false when element and viewport don't overlap
                if (entries[0].isIntersecting === true) {
                    let id = entries[0].target.id;
                    markItem(id);
                }

            }, {
                threshold: [0]
            });

            window.addEventListener("load", function() {
                document.querySelectorAll("h1, h2, h3").forEach(function(item) {
                    observer.observe(item);
                });

                document.querySelectorAll("#TOC a").forEach(function(item) {
                    item.addEventListener("click", function(item) {
                        markItem(item.id);
                    })
                })

                // Fem modals totes les imatges
                ModalizeImages();
            })

            document.querySelector("#TOC").addEventListener("click", function(event) {
                let toc = event.target
                if (toc.offsetWidth > 10) {
                    toc.classList.add("minimizedToc");
                }
            })

            document.querySelector("#TOC").addEventListener("mouseover", function(event) {
                let toc = event.target
                if (toc.classList.contains("minimizedToc"))
                    toc.classList.remove("minimizedToc");
            })


                        
            /* PER COPIAR CODI */


            // Busca tots els elements amb la classe "sourceCode"
            var sourceCodeElements = document.querySelectorAll('div.sourceCode');

            /*Afegim el botó a tots els divs */
            // Afegir un botó per a cada element "sourceCode"
            sourceCodeElements.forEach(function(element) {
                console.log(element.id);
                var button = document.createElement('div');
                button.className = 'button-copy';

                // Afegir una icona al botó (fa servir FontAwesome com a exemple)
                //var icon = document.createElement('i');
                //icon.className = 'fas fa-copy'; // Utilitza l'ícona "copy" de FontAwesome

                // Obté l'ID de l'element actual
                var elementId = element.id;

                // Afegeix un event listener al botó per cridar la funció amb l'ID
                button.addEventListener('click', function() {
                    copyContent(elementId);
                });

                // Afegeix l'icona al botó i el botó just dins de l'element "sourceCode"
                //button.appendChild(icon);
                element.appendChild(button);
            });



            // Funció per copiar el contingut d'un element amb l'ID donat
            function copyContent(elementId) {
                var element = document.getElementById(elementId);
                var textToCopy = element.innerText;

                // Crea un element de text i copia el contingut
                var textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);

                // Selecciona i copia el text
                textArea.select();
                document.execCommand('copy');

                // Elimina l'element de text afegit temporalment
                document.body.removeChild(textArea);

                // Notifica a l'usuari que el codi s'ha copiat
                mostraSnackbar();
            }

            /* SNACKBAR EN COPIAR CODI */

            function mostraSnackbar() {
            // Busquem l'snackbar
            var x = document.getElementById("snackbar");

            // Li afegim la classe show
            x.className = "show";

            // I als tres segons la llevem
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            } 




        </script>
    </div>
</body>

</html>