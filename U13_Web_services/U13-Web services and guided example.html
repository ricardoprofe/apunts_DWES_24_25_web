<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-UK" xml:lang="en-UK" >

<head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />     <meta name="author" content="Fidel Oltra, Ricardo Sánchez" />        <title>Unit 13. Web services and security.</title>
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        div.columns{display: flex; gap: min(4vw, 1.5em);}
        div.column{flex: auto; overflow-x: auto;}
        div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
        /* The extra [class] is a hack that increases specificity enough to
           override a similar rule in reveal.js */
        ul.task-list[class]{list-style: none;}
        ul.task-list li input[type="checkbox"] {
          font-size: inherit;
          width: 0.8em;
          margin: 0 0.8em 0.2em -1.6em;
          vertical-align: middle;
        }
        .display.math{display: block; text-align: center; margin: 0.5rem auto;}
        /* CSS for syntax highlighting */
        pre > code.sourceCode { white-space: pre; position: relative; }
        pre > code.sourceCode > span { line-height: 1.25; }
        pre > code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        pre > code.sourceCode { white-space: pre-wrap; }
        pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {  background-color: #f8f8f8; }
        @media screen {
        pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ef2929; } /* Alert */
        code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
        code span.at { color: #204a87; } /* Attribute */
        code span.bn { color: #0000cf; } /* BaseN */
        code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
        code span.ch { color: #4e9a06; } /* Char */
        code span.cn { color: #8f5902; } /* Constant */
        code span.co { color: #8f5902; font-style: italic; } /* Comment */
        code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
        code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
        code span.dt { color: #204a87; } /* DataType */
        code span.dv { color: #0000cf; } /* DecVal */
        code span.er { color: #a40000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.fl { color: #0000cf; } /* Float */
        code span.fu { color: #204a87; font-weight: bold; } /* Function */
        code span.im { } /* Import */
        code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
        code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
        code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
        code span.ot { color: #8f5902; } /* Other */
        code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
        code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
        code span.ss { color: #4e9a06; } /* SpecialString */
        code span.st { color: #4e9a06; } /* String */
        code span.va { color: #000000; } /* Variable */
        code span.vs { color: #4e9a06; } /* VerbatimString */
        code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
        <link rel="stylesheet" href="../web_template/aqua.css" />  
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
      
</head>

<body>
    <div id="content">
                 <header id="title-block-header">
            <h1 class="title">Unit 13. Web services and security.</h1>
            <!---->
            <!--         <p class="author">Fidel Oltra, Ricardo
Sánchez</p>
         -->
                    </header>
                 <nav id="TOC" role="doc-toc">
            <div class="navContainer">
                                <h2 id="toc-title">Index</h2>
                 <ul>
<li><a href="#web-services-with-symfony"
id="toc-web-services-with-symfony"><span
class="toc-section-number">1</span> Web services with Symfony</a></li>
<li><a href="#building-the-api-rest-manually"
id="toc-building-the-api-rest-manually"><span
class="toc-section-number">2</span> Building the API REST manually</a>
<ul>
<li><a href="#installing-required-bundles"
id="toc-installing-required-bundles"><span
class="toc-section-number">2.1</span> Installing required
bundles</a></li>
<li><a href="#transforming-objects-tofrom-json"
id="toc-transforming-objects-tofrom-json"><span
class="toc-section-number">2.2</span> Transforming objects to/from
JSON</a></li>
<li><a href="#making-the-services" id="toc-making-the-services"><span
class="toc-section-number">2.3</span> Making the services</a>
<ul>
<li><a href="#getting-all-the-contacts-get"
id="toc-getting-all-the-contacts-get"><span
class="toc-section-number">2.3.1</span> Getting all the contacts
(GET)</a></li>
<li><a href="#getting-one-contact-get"
id="toc-getting-one-contact-get"><span
class="toc-section-number">2.3.2</span> Getting one contact
(GET)</a></li>
<li><a href="#posting-one-contact-post"
id="toc-posting-one-contact-post"><span
class="toc-section-number">2.3.3</span> Posting one contact
(POST)</a></li>
<li><a href="#modifying-a-contact-put"
id="toc-modifying-a-contact-put"><span
class="toc-section-number">2.3.4</span> Modifying a contact
(PUT)</a></li>
<li><a href="#removing-a-contact-delete"
id="toc-removing-a-contact-delete"><span
class="toc-section-number">2.3.5</span> Removing a contact
(DELETE)</a></li>
</ul></li>
<li><a href="#validation" id="toc-validation"><span
class="toc-section-number">2.4</span> Validation</a></li>
</ul></li>
<li><a href="#api-rest-with-api-platform"
id="toc-api-rest-with-api-platform"><span
class="toc-section-number">3</span> API REST with API Platform</a>
<ul>
<li><a href="#standards-used-by-api-platform"
id="toc-standards-used-by-api-platform"><span
class="toc-section-number">3.1</span> Standards used by API
Platform</a></li>
<li><a href="#building-the-api-rest-with-api-platform"
id="toc-building-the-api-rest-with-api-platform"><span
class="toc-section-number">3.2</span> Building the API REST with API
Platform</a></li>
<li><a href="#modifying-the-api" id="toc-modifying-the-api"><span
class="toc-section-number">3.3</span> Modifying the API</a></li>
<li><a href="#serialization" id="toc-serialization"><span
class="toc-section-number">3.4</span> Serialization</a></li>
<li><a href="#documenting-the-api" id="toc-documenting-the-api"><span
class="toc-section-number">3.5</span> Documenting the API</a></li>
<li><a href="#subresources" id="toc-subresources"><span
class="toc-section-number">3.6</span> Subresources</a></li>
<li><a href="#filters" id="toc-filters"><span
class="toc-section-number">3.7</span> Filters</a></li>
<li><a href="#validation-1" id="toc-validation-1"><span
class="toc-section-number">3.8</span> Validation</a></li>
</ul></li>
<li><a href="#security" id="toc-security"><span
class="toc-section-number">4</span> Security</a>
<ul>
<li><a href="#the-security.yaml-file"
id="toc-the-security.yaml-file"><span
class="toc-section-number">4.1</span> The <em>security.yaml</em>
file</a></li>
<li><a href="#the-user" id="toc-the-user"><span
class="toc-section-number">4.2</span> The User</a>
<ul>
<li><a href="#hashing-passwords" id="toc-hashing-passwords"><span
class="toc-section-number">4.2.1</span> Hashing Passwords</a></li>
</ul></li>
<li><a href="#token-based-authentication"
id="toc-token-based-authentication"><span
class="toc-section-number">4.3</span> Token based
authentication</a></li>
<li><a href="#configuring-the-api" id="toc-configuring-the-api"><span
class="toc-section-number">4.4</span> Configuring the API</a></li>
<li><a href="#registering-users" id="toc-registering-users"><span
class="toc-section-number">4.5</span> Registering users</a></li>
<li><a href="#access-control" id="toc-access-control"><span
class="toc-section-number">4.6</span> Access control</a></li>
<li><a href="#usage" id="toc-usage"><span
class="toc-section-number">4.7</span> Usage</a></li>
</ul></li>
</ul>
            </div>
        </nav>
                <main>
            <h1 data-number="1" id="web-services-with-symfony"><span
            class="header-section-number">1</span> Web services with
            Symfony</h1>
            <p>We have already work with REST API’s in unit 8. Just
            remember the key concepts:</p>
            <p><strong>Rest services:</strong></p>
            <table>
            <thead>
            <tr class="header">
            <th>METHOD</th>
            <th>FUNCTION</th>
            </tr>
            </thead>
            <tbody>
            <tr class="odd">
            <td>GET</td>
            <td>Retrieve information from the service</td>
            </tr>
            <tr class="even">
            <td>POST</td>
            <td>Create an new resource</td>
            </tr>
            <tr class="odd">
            <td>PUT</td>
            <td>Update a particular resource</td>
            </tr>
            <tr class="even">
            <td>DELETE</td>
            <td>Remove a particular resource</td>
            </tr>
            </tbody>
            </table>
            <p><a
            href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP
            response status codes</a></p>
            <p><a
            href="https://www.w3schools.com/js/js_json_syntax.asp">JSON
            syntax</a></p>
            <p><a
            href="https://www.w3schools.com/js/js_json_datatypes.asp">JSON
            data types</a></p>
            <h1 data-number="2"
            id="building-the-api-rest-manually"><span
            class="header-section-number">2</span> Building the API REST
            manually</h1>
            <p>In this example we will make a REST web service based on
            our Contacts application. It follows the last guided
            practice.</p>
            <p>In the databases unit we made entity classes and the
            database access functionalities. These parts will remain the
            same, the only thing we have to do is to add API REST
            functionality.</p>
            <p>Before doing this point, it’s recommended to make a new
            branch, named, for instance, ‘manual-rest’.</p>
            <h2 data-number="2.1" id="installing-required-bundles"><span
            class="header-section-number">2.1</span> Installing required
            bundles</h2>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">composer</span> config extra.symfony.allow-contrib true</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">composer</span> require jms/serializer-bundle</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">composer</span> require friendsofsymfony/rest-bundle</span></code></pre></div>
            <p>The first command is to allow contrib bundles. We will
            use the <code>friendsofsymfony/rest-bundle</code> bundle to
            specify the REST methods as annotations. The
            <code>serializer-bundle</code> is a dependency for the
            <code>rest-bundle</code>.</p>
            <h2 data-number="2.2"
            id="transforming-objects-tofrom-json"><span
            class="header-section-number">2.2</span> Transforming
            objects to/from JSON</h2>
            <p>As we need the objects we send and get via the API to be
            encoded as JSON, we will do this task in the entity
            classes.</p>
            <p>First, we will encode a contact object as an array. Go to
            the Contact class and add the next method:</p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> toArray()<span class="ot">:</span> <span class="dt">array</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">$phoneList</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">foreach</span> (<span class="va">$this</span>-&gt;phones <span class="kw">as</span> <span class="va">$phone</span>) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$phoneList</span>[] <span class="op">=</span> [</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;number&#39;</span> =&gt; <span class="va">$phone</span>-&gt;getNumber()<span class="ot">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;type&#39;</span> =&gt; <span class="va">$phone</span>-&gt;<span class="fu">getType</span>()<span class="ot">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">$contactArray</span> <span class="op">=</span> [</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;id&#39;</span> =&gt; <span class="va">$this</span>-&gt;id<span class="ot">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;title&#39;</span> =&gt; <span class="va">$this</span>-&gt;title<span class="ot">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;name&#39;</span> =&gt; <span class="va">$this</span>-&gt;name<span class="ot">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;surname&#39;</span> =&gt; <span class="va">$this</span>-&gt;surname<span class="ot">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;email&#39;</span> =&gt; <span class="va">$this</span>-&gt;email<span class="ot">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;birthdate&#39;</span> =&gt; <span class="va">$this</span>-&gt;birthdate-&gt;format(<span class="st">&#39;Y-m-d&#39;</span>)<span class="ot">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;phones&#39;</span> =&gt; <span class="va">$phoneList</span><span class="ot">,</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">$contactArray</span><span class="ot">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>As you can see, this function transforms a contact object
            in an array that we will transform later.</p>
            <p>Although you can do this task with the <a
            href="https://symfony.com/doc/current/components/serializer.html#serializing-an-object">Serializer
            component</a> of Symfony, this way is more comprehensive and
            we have more control over the process.</p>
            <p>We also need to transform a JSON encoded object into a
            contact object, with the next method:</p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> fromJson(<span class="va">$content</span>)<span class="ot">:</span> <span class="dt">void</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">$content</span> <span class="op">=</span> <span class="fu">json_decode</span>(<span class="va">$content</span><span class="ot">,</span> <span class="kw">true</span>)<span class="ot">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;title <span class="op">=</span> <span class="va">$content</span>[<span class="st">&#39;title&#39;</span>]<span class="ot">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;name <span class="op">=</span> <span class="va">$content</span>[<span class="st">&#39;name&#39;</span>]<span class="ot">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;surname <span class="op">=</span> <span class="va">$content</span>[<span class="st">&#39;surname&#39;</span>]<span class="ot">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;email <span class="op">=</span> <span class="va">$content</span>[<span class="st">&#39;email&#39;</span>]<span class="ot">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">$date</span> <span class="op">=</span> <span class="bu">DateTime</span>::createFromFormat(<span class="st">&#39;Y-m-d&#39;</span><span class="ot">,</span> <span class="va">$content</span>[<span class="st">&#39;birthdate&#39;</span>])<span class="ot">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="va">$date</span>){</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;birthdate <span class="op">=</span>  <span class="va">$date</span><span class="ot">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;birthdate <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>We use the <code>json_decode</code> function to transform
            the JSON content to an array and then assign the data values
            to the object. Note that here we aren’t inserting or
            updating the phones. You can implement that if you want.</p>
            <p>An important thing is that, if some key is incorrect or
            is not present, the system will launch an error. However, we
            will manage it in the controller class.</p>
            <h2 data-number="2.3" id="making-the-services"><span
            class="header-section-number">2.3</span> Making the
            services</h2>
            <p>First, make a new controller for the contact api:</p>
            <pre><code>symfony console make:controller ApiContact</code></pre>
            <p>We don’t need the template created automatically, so you
            can delete the <code>api_contact</code> folder with the Twig
            file inside.</p>
            <p>Modify the <code>ApiContactController</code> class:</p>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">C</span>ontroller<span class="ot">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">D</span>octrine\<span class="cn">P</span>ersistence\<span class="cn">M</span>anagerRegistry<span class="ot">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">B</span>undle\<span class="cn">F</span>rameworkBundle\<span class="cn">C</span>ontroller\<span class="cn">A</span>bstractController<span class="ot">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">H</span>ttpFoundation\<span class="cn">J</span>sonResponse<span class="ot">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">H</span>ttpFoundation\<span class="cn">R</span>equest<span class="ot">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">R</span>outing\<span class="cn">A</span>nnotation\<span class="cn">R</span>oute<span class="ot">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">FOS</span>\<span class="cn">R</span>estBundle\<span class="cn">C</span>ontroller\<span class="cn">A</span>nnotations <span class="kw">as</span> <span class="cn">R</span>est<span class="ot">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>pp\<span class="cn">E</span>ntity\<span class="cn">C</span>ontact<span class="ot">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>oute(<span class="st">&#39;/api/contact&#39;</span>)<span class="at">]</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">A</span>piContactController <span class="kw">extends</span> <span class="cn">A</span>bstractController</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>The class has a <code>Route</code> annotation, which
            means that any route we specify inside will have that prefix
            (in this case, all the routes of the internal methods will
            have the prefix <code>/api/contact</code>).</p>
            <h3 data-number="2.3.1"
            id="getting-all-the-contacts-get"><span
            class="header-section-number">2.3.1</span> Getting all the
            contacts (GET)</h3>
            <p>To return all the contacts, we first must to fetch them
            from the database, add them to an array and return it as a
            <code>JsonResponse</code> with the code 200:</p>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">G</span>et(<span class="st">&#39;/&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;contact_api_list&#39;</span>)<span class="at">]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> contactApiList(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">$contacts</span> <span class="op">=</span> <span class="va">$entityManager</span>-&gt;getRepository(<span class="cn">C</span>ontact::<span class="kw">class</span>)-&gt;findAll()<span class="ot">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">$contactsList</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">count</span>(<span class="va">$contacts</span>) <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">foreach</span>(<span class="va">$contacts</span> <span class="kw">as</span> <span class="va">$contact</span>) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">$contactsList</span>[] <span class="op">=</span> <span class="va">$contact</span>-&gt;toArray()<span class="ot">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;contacts&#39;</span> =&gt; <span class="va">$contactsList</span><span class="ot">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;error&#39;</span> =&gt; <span class="st">&#39;No contacts found&#39;</span><span class="ot">,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">200</span>)<span class="ot">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>Note how we are specifying the route with an
            attribute:</p>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">G</span>et(<span class="st">&#39;/&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;api_contact_list&#39;</span>)<span class="at">]</span></span></code></pre></div>
            <p>In this attribute, the path <code>/</code> is added to
            the class path <code>/api/contact</code>.</p>
            <p>We also send with the response an <em>ok</em> code to
            know if the fetching of the data has been successful and an
            error message if not.</p>
            <p>We can check the route simply writing the URL in a
            browser. You can also use Postman to do that. :</p>
            <figure>
            <img src="images/get_list.png"
            alt="All the contacts in Firefox" />
            <figcaption aria-hidden="true">All the contacts in
            Firefox</figcaption>
            </figure>
            <h3 data-number="2.3.2" id="getting-one-contact-get"><span
            class="header-section-number">2.3.2</span> Getting one
            contact (GET)</h3>
            <p>This is similar to the previous request, but adding the
            id of the requested contact to the route.</p>
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">G</span>et(<span class="st">&#39;/{id&lt;\d+&gt;}&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;single_contact_api&#39;</span>)<span class="at">]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> index(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span><span class="ot">,</span> <span class="va">$id</span><span class="op">=</span><span class="st">&#39;&#39;</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">$contact</span> <span class="op">=</span> <span class="va">$entityManager</span>-&gt;getRepository(<span class="cn">C</span>ontact::<span class="kw">class</span>)-&gt;find(<span class="va">$id</span>)<span class="ot">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="va">$contact</span>) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contactArray</span> <span class="op">=</span> <span class="va">$contact</span>-&gt;toArray()<span class="ot">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;contact&#39;</span> =&gt; <span class="va">$contactArray</span><span class="ot">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">200</span>)<span class="ot">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;error&#39;</span> =&gt; <span class="st">&#39;No contact found with id &#39;</span><span class="op">.</span><span class="va">$id</span><span class="ot">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">404</span>)<span class="ot">;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <figure>
            <img src="images/get_one.png"
            alt="JSON response for the contact with id=11" />
            <figcaption aria-hidden="true">JSON response for the contact
            with id=11</figcaption>
            </figure>
            <h3 data-number="2.3.3" id="posting-one-contact-post"><span
            class="header-section-number">2.3.3</span> Posting one
            contact (POST)</h3>
            <p>In this example we are going to insert a single contact
            without phones, but you can easily extend the functionality
            adding phones to an existing contact.</p>
            <p>To insert a contact we use the POST method and the
            default route (<code>/api/contact</code>). As the method is
            different from GET, we can reuse the same route with a
            different operation.</p>
            <p>Here, the <code>$request-&gt;getContent()</code> method
            is responsible for getting the json string.</p>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">P</span>ost(<span class="st">&#39;/&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;contact_api_new_contact&#39;</span>)<span class="at">]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> newContact(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span><span class="ot">,</span> <span class="cn">R</span>equest <span class="va">$request</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$content</span> <span class="op">=</span> <span class="va">$request</span>-&gt;getContent()<span class="ot">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">C</span>ontact()<span class="ot">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span>-&gt;fromJson(<span class="va">$content</span>)<span class="ot">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$entityManager</span>-&gt;persist(<span class="va">$contact</span>)<span class="ot">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$entityManager</span>-&gt;<span class="fu">flush</span>()<span class="ot">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span> =&gt; <span class="st">&#39;contact inserted&#39;</span><span class="ot">,</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">201</span>)<span class="ot">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (\<span class="bu">Throwable</span> <span class="va">$e</span>) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;error&#39;</span> =&gt; <span class="st">&#39;Failed to insert contact: &#39;</span><span class="op">.</span><span class="va">$e</span>-&gt;getMessage()<span class="ot">,</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">400</span>)<span class="ot">;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <blockquote>
            <p>To use the <code>Request</code> class, you need to import
            the <code>Symfony\Component\HttpFoundation\Request</code>
            library.</p>
            </blockquote>
            <p>Note how we are handling the operation’s errors with a
            <code>try-catch</code> block, because the
            <code>fromJson</code> method will launch an error if some
            key is inexistent.</p>
            <p>To make a POST request with Postman, change the method to
            POST and write in the <strong>Body</strong> section, in
            <strong>raw</strong> format, the data that you want to
            insert:</p>
            <figure>
            <img src="images/post_request_postman.png"
            alt="POST request with Postman" />
            <figcaption aria-hidden="true">POST request with
            Postman</figcaption>
            </figure>
            <figure>
            <img src="images/post_request_postman_result.png"
            alt="Result of the POST request" />
            <figcaption aria-hidden="true">Result of the POST
            request</figcaption>
            </figure>
            <h3 data-number="2.3.4" id="modifying-a-contact-put"><span
            class="header-section-number">2.3.4</span> Modifying a
            contact (PUT)</h3>
            <p>This method is similar to the previous one, but fetching
            first the contact by its <code>id</code> and modifying it
            later with the request data. We are using the same base
            route but changing the method and adding the <code>id</code>
            of the contact.</p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">P</span>ut(<span class="st">&#39;/{id&lt;\d+&gt;}&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;contact_api_edit_contact&#39;</span>)<span class="at">]</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> editContact(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span><span class="ot">,</span> <span class="cn">R</span>equest <span class="va">$request</span><span class="ot">,</span> <span class="va">$id</span><span class="op">=</span><span class="st">&#39;&#39;</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$content</span> <span class="op">=</span> <span class="va">$request</span>-&gt;getContent()<span class="ot">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span> <span class="op">=</span> <span class="va">$entityManager</span>-&gt;getRepository(<span class="cn">C</span>ontact::<span class="kw">class</span>)-&gt;find(<span class="va">$id</span>)<span class="ot">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span>-&gt;fromJson(<span class="va">$content</span>)<span class="ot">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$entityManager</span>-&gt;<span class="fu">flush</span>()<span class="ot">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span> =&gt; <span class="st">&#39;contact updated&#39;</span><span class="ot">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">201</span>)<span class="ot">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (\<span class="bu">Throwable</span> <span class="va">$e</span>) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;error&#39;</span> =&gt; <span class="st">&#39;Failed to update contact: &#39;</span><span class="op">.</span><span class="va">$e</span>-&gt;getMessage()<span class="ot">,</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">400</span>)<span class="ot">;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>The PUT request with Postman can be done changing to the
            PUT method and writing the data with the desired
            changes:</p>
            <figure>
            <img src="images/put_request_postman.png"
            alt="PUT request with Postman" />
            <figcaption aria-hidden="true">PUT request with
            Postman</figcaption>
            </figure>
            <figure>
            <img src="images/put_request_postman_result.png"
            alt="Result of the PUT request" />
            <figcaption aria-hidden="true">Result of the PUT
            request</figcaption>
            </figure>
            <h3 data-number="2.3.5" id="removing-a-contact-delete"><span
            class="header-section-number">2.3.5</span> Removing a
            contact (DELETE)</h3>
            <p>The same as before, but using the DELETE method. Here we
            are deleting the contact’s phones so that the DBMS doesn’t
            throw an error.</p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">R</span>est\<span class="cn">D</span>elete(<span class="st">&#39;/{id&lt;\d+&gt;}&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;contact_api_delete_contact&#39;</span>)<span class="at">]</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> deleteContact(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span><span class="ot">,</span> <span class="va">$id</span><span class="op">=</span><span class="st">&#39;&#39;</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">$contact</span> <span class="op">=</span> <span class="va">$entityManager</span>-&gt;getRepository(<span class="cn">C</span>ontact::<span class="kw">class</span>)-&gt;find(<span class="va">$id</span>)<span class="ot">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="va">$contact</span>) {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">foreach</span>(<span class="va">$contact</span>-&gt;getPhones() <span class="kw">as</span> <span class="va">$phone</span>){</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="va">$entityManager</span>-&gt;remove(<span class="va">$phone</span>)<span class="ot">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">$entityManager</span>-&gt;remove(<span class="va">$contact</span>)<span class="ot">;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$entityManager</span>-&gt;<span class="fu">flush</span>()<span class="ot">;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;message&#39;</span> =&gt; <span class="st">&#39;contact deleted&#39;</span><span class="ot">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">200</span>)<span class="ot">;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;error&#39;</span> =&gt; <span class="st">&#39;Delete failed: contact not found&#39;</span><span class="ot">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        ]<span class="ot">;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">404</span>)<span class="ot">;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>And to do the DELETE request with Postman, we only need
            to specify the DELETE method and to pass the id with the
            URL:</p>
            <figure>
            <img src="images/delete_and_result.png"
            alt="DELETE request and result with Postman" />
            <figcaption aria-hidden="true">DELETE request and result
            with Postman</figcaption>
            </figure>
            <p>Remember to save your requests in order to reuse them
            later.</p>
            <h2 data-number="2.4" id="validation"><span
            class="header-section-number">2.4</span> Validation</h2>
            <p>In Symfony, the validation is done in the underlying
            objects. To do the data validation, we are going to use the
            Symfony validator. First, install the package in your
            project:</p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">composer</span> require symfony/validator</span></code></pre></div>
            <p>We will use it to validate that the data you receive from
            a service (POST or PUT) are correct before carrying out the
            corresponding insertions or modifications.</p>
            <p>Validation is done by adding a set of rules, called
            <strong><em>constraints</em></strong>, to a class.</p>
            <p>The first thing is to import the validation constraints
            on the <code>Contact</code> and <code>Phone</code>
            classes:</p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">V</span>alidator\<span class="cn">C</span>onstraints <span class="kw">as</span> <span class="fu">Assert</span><span class="ot">;</span></span></code></pre></div>
            <p>Then, add the constraints as <strong>asserts</strong> to
            each property with attributes:</p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Contact</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(length: 5, options: [&quot;default&quot;=&gt; &quot;Mr.&quot;])]</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\NotBlank]</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>private ?string $title <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(length: 100)]</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\NotBlank]</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>private ?string $name <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(length: 100, nullable: true)]</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>private ?string $surname <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(type: Types::DATE_MUTABLE)]</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\NotBlank]</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>private ?\DateTimeInterface $birthdate <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(length: 50, nullable: true)]</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\Email]</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>private ?string $email <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Phone</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Id]</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#[ORM\Column(length: 20)]</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\NotBlank]</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>private ?string $number <span class="op">=</span> null<span class="op">;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a> <span class="co">#[ORM\Column(length: 10, options: [&quot;default&quot;=&gt; &quot;Mobile&quot;])]</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#[Assert\NotBlank]</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>private ?string $type <span class="op">=</span> null<span class="op">;</span></span></code></pre></div>
            <p>If you want you can customize the error message:</p>
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">E</span>mail(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    message<span class="ot">:</span> <span class="st">&#39;The email {{ value }} is not a valid email.&#39;</span><span class="ot">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>)<span class="at">]</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$email</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span></code></pre></div>
            <p>Here, a list of all the constraints: <a
            href="https://symfony.com/doc/current/validation.html#constraints">Symfony
            validation constraints</a></p>
            <p>Then, in the <code>ApiContactController</code> class,
            import the <code>ValidatorInterface</code> and inject it in
            the PUT and POST methods for using it to validate the
            received data. The validator returns a list with the errors
            detected, so, if that number is zero, there are not errors
            and we can continue with the database operation. Each error
            is an object, so we use the methods
            <code>getPropertyPath</code> and <code>getMessage</code> to
            get the property and the correspondent error message:</p>
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">V</span>alidator\<span class="cn">V</span>alidator\<span class="cn">V</span>alidatorInterface<span class="ot">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a> <span class="at">#[</span><span class="cn">R</span>est\<span class="cn">P</span>ost(<span class="st">&#39;/&#39;</span><span class="ot">,</span> name<span class="ot">:</span> <span class="st">&#39;contact_api_new_contact&#39;</span>)<span class="at">]</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> newContact(<span class="cn">E</span>ntityManagerInterface <span class="va">$entityManager</span><span class="ot">,</span> <span class="cn">R</span>equest <span class="va">$request</span><span class="ot">,</span> <span class="cn">V</span>alidatorInterface <span class="va">$validator</span>)<span class="ot">:</span> <span class="cn">J</span>sonResponse {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$content</span> <span class="op">=</span> <span class="va">$request</span>-&gt;getContent()<span class="ot">;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">C</span>ontact()<span class="ot">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">$contact</span>-&gt;fromJson(<span class="va">$content</span>)<span class="ot">;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">$errors</span> <span class="op">=</span> <span class="va">$validator</span>-&gt;validate(<span class="va">$contact</span>)<span class="ot">;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">count</span>(<span class="va">$errors</span>) <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">$entityManager</span>-&gt;persist(<span class="va">$contact</span>)<span class="ot">;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">$entityManager</span>-&gt;<span class="fu">flush</span>()<span class="ot">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">true</span><span class="ot">,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;message&#39;</span> =&gt; <span class="st">&#39;contact inserted&#39;</span><span class="ot">,</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            ]<span class="ot">;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">201</span>)<span class="ot">;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>            <span class="va">$errorsArray</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">foreach</span> (<span class="va">$errors</span> <span class="kw">as</span> <span class="va">$error</span>){</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                <span class="va">$errorsArray</span>[] <span class="op">=</span> <span class="dt">array</span>(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                    <span class="va">$error</span>-&gt;getPropertyPath() =&gt; <span class="va">$error</span>-&gt;getMessage()</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                )<span class="ot">;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">$response</span> <span class="op">=</span> [</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;ok&#39;</span> =&gt; <span class="kw">false</span><span class="ot">,</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;message&#39;</span> =&gt; <span class="st">&#39;Failed to insert contact: errors in data&#39;</span><span class="ot">,</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;errors&#39;</span> =&gt; <span class="va">$errorsArray</span> <span class="ot">,</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            ]<span class="ot">;</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="cn">J</span>sonResponse(<span class="va">$response</span><span class="ot">,</span> <span class="dv">400</span>)<span class="ot">;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>The code for the PUT method is similar.</p>
            <p>Now, if we wanted to post a new contact with invalid
            data, the operation would not be done:</p>
            <figure>
            <img src="images/post_no_validated.png"
            alt="POST request with invalid email data" />
            <figcaption aria-hidden="true">POST request with invalid
            email data</figcaption>
            </figure>
            <p>You can get all the code from the <a
            href="https://github.com/ricardoprofe/contacts_symfony-u13">GitHub
            repository</a>.</p>
            <h1 data-number="3" id="api-rest-with-api-platform"><span
            class="header-section-number">3</span> API REST with API
            Platform</h1>
            <p><strong>API Platform</strong> is an Open Source web
            framework for API-first projects. Describe the API’s data
            model or import an existing one from Schema.org and get
            instantly a fully featured read/write API with REST
            operations, data validation, pagination, sorting, filtering,
            etc.</p>
            <p>In this section, we will see an introduction ti API
            Platform. You can expand you knowledge in their webpage: <a
            href="https://api-platform.com/">https://api-platform.com/</a></p>
            <h2 data-number="3.1"
            id="standards-used-by-api-platform"><span
            class="header-section-number">3.1</span> Standards used by
            API Platform</h2>
            <p>API Platform generates the API in Json, but it use
            several technologies in addition. Let’s see the more
            important:</p>
            <ul>
            <li><p><strong>JSON-LD</strong>: JavaScript Object Notation
            for Linked Data. JSON-LD is designed around the concept of a
            <strong>“context”</strong> to provide additional mappings
            from JSON to an <a
            href="https://en.wikipedia.org/wiki/Resource_Description_Framework">RDF</a>
            model. So, with JSON-LD, we can define the schema of a JSON
            document.</p>
            <p><a
            href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></p></li>
            <li><p><strong>Hydra</strong>: Hydra is a vocabulary to
            simplify the development and consumption of web APIs. It’s
            like JSON-LD, but with standardized operations. The core if
            Hydra is the <strong>Hydra Core Vocabulary</strong>, which
            describes the most common API operations.</p>
            <p><a
            href="https://www.hydra-cg.com/">https://www.hydra-cg.com/</a></p>
            <figure>
            <img src="images/json_ld_hydra.png" width="350"
            alt="JSON-LD and Hydra fields" />
            <figcaption aria-hidden="true">JSON-LD and Hydra
            fields</figcaption>
            </figure></li>
            <li><p><strong>JSON Schema</strong>: JSON Schema specifies a
            JSON-based format to define the structure of JSON data for
            validation, documentation, and interaction control. It is
            based on the concepts from XML Schema (XSD) but is
            JSON-based.</p>
            <p><a
            href="https://json-schema.org/">https://json-schema.org/</a></p>
            <figure>
            <img src="images/json-schema.png" width="350"
            alt="JSON Schema" />
            <figcaption aria-hidden="true">JSON Schema</figcaption>
            </figure></li>
            <li><p><strong>Swagger</strong>: Swagger is an API
            Specification based on OpenAPI and a suite of tools based on
            it. In API Platform, Swagger is responsible for an interface
            for the JSON, JSON-LD, Hydra, JSON Schema, etc, data.</p>
            <figure>
            <img src="images/swagger.png" alt="Swagger" />
            <figcaption aria-hidden="true">Swagger</figcaption>
            </figure></li>
            </ul>
            <h2 data-number="3.2"
            id="building-the-api-rest-with-api-platform"><span
            class="header-section-number">3.2</span> Building the API
            REST with API Platform</h2>
            <p>To show how to work with API Platform, we will create a
            new project from scratch. We are going to do the menu of an
            Italian restaurant, with dishes grouped by categories.</p>
            <p>The first thing is to create the project and the required
            dependencies:</p>
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>symfony <span class="kw">new</span> italian_restaurant <span class="op">--</span>version<span class="op">=</span><span class="st">&quot;7.1.*&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cd italian_restaurant</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>composer <span class="kw">require</span> <span class="op">--</span>dev symfony<span class="op">/</span>maker<span class="op">-</span>bundle</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>composer <span class="kw">require</span> api</span></code></pre></div>
            <p>As you can see, we only require the maker bundle, because
            we don’t need views (Doctrine is installed with API
            Platform). The last packet, <code>'api'</code>, is the API
            Platform dependency.</p>
            <p>Then, create the <code>.env.local</code> file to
            configure the database connection, as seen in the previous
            unit, and create the database:</p>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cn">DATABASE_URL</span><span class="op">=</span><span class="st">&quot;mysql://restaurant:restaurant@127.0.0.1:3306/restaurant?serverVersion=8.0.32&amp;charset=utf8mb4&quot;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">or</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cn">DATABASE_URL</span><span class="op">=</span><span class="st">&quot;mysql://restaurant:restaurant@127.0.0.1:3306/restaurant?serverVersion=10.11.2-MariaDB&amp;charset=utf8mb4&quot;</span></span></code></pre></div>
            <div class="sourceCode" id="cb19"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="fu">USER</span> <span class="st">&#39;restaurant&#39;</span>@<span class="st">&#39;%&#39;</span> <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="st">&#39;restaurant&#39;</span>;</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> `restaurant`;</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> `restaurant`.<span class="op">*</span> <span class="kw">TO</span> <span class="st">&#39;restaurant&#39;</span>@<span class="st">&#39;%&#39;</span>;</span></code></pre></div>
            <p>Finally, create the entities <code>dish</code> and
            <code>category</code>:</p>
            <pre class="console"><code>symfony console make:entity

 Class name of the entity to create or update:
 &gt; Category

Mark this class as an API Platform resource (expose a CRUD API for it) (yes/no) [no]:
&gt; yes

 created: src/Entity/Category.php
 created: src/Repository/CategoryRepository.php
 
 Entity generated! Now let&#39;s add some fields!
 You can always add more fields later manually or by re-running this command.

 New property name (press &lt;return&gt; to stop adding fields):
 &gt; name

 Field type (enter ? to see all types) [string]:
 &gt; 

 Field length [255]:
 &gt; 100

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; no

 updated: src/Entity/Category.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; description

 Field type (enter ? to see all types) [string]:
 &gt; 

 Field length [255]:
 &gt; 255

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; yes

 updated: src/Entity/Category.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; 
           
  Success! </code></pre>
            <pre class="console"><code>symfony console make:entity Dish

 created: src/Entity/Dish.php
 created: src/Repository/DishRepository.php
 
 New property name (press &lt;return&gt; to stop adding fields):
 &gt; name

 Field type (enter ? to see all types) [string]:
 &gt; string

 Field length [255]:
 &gt; 100

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; no

 updated: src/Entity/Dish.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; ingredients

 Field type (enter ? to see all types) [string]:
 &gt; string

 Field length [255]:
 &gt; 255

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; yes

 updated: src/Entity/Dish.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; price

 Field type (enter ? to see all types) [string]:
 &gt; decimal

 Precision (total number of digits stored: 100.00 would be 5) [10]:
 &gt; 10

 Scale (number of decimals to store: 100.00 would be 2) [0]:
 &gt; 2

 Can this field be null in the database (nullable) (yes/no) [no]:
 &gt; no

 updated: src/Entity/Dish.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; category

 Field type (enter ? to see all types) [string]:
 &gt; relation

 What class should this entity be related to?:
 &gt; Category

What type of relationship is this?
 ...
 Relation type? [ManyToOne, OneToMany, ManyToMany, OneToOne]:
 &gt; ManyToOne

 Is the Dish.category property allowed to be null (nullable)? (yes/no) [yes]:
 &gt; no

 Do you want to add a new property to Category so that you can access/update Dish objects from it - e.g. $category-&gt;getDishes()? (yes/no) [yes]:
 &gt; yes

 A new property will also be added to the Category class so that you can access the related Dish objects from it.

 New field name inside Category [dishes]:
 &gt; dishes 

 Do you want to automatically delete orphaned App\Entity\Dish objects (orphanRemoval)? (yes/no) [no]:
 &gt; no

 updated: src/Entity/Dish.php
 updated: src/Entity/Category.php

 Add another property? Enter the property name (or press &lt;return&gt; to stop adding fields):
 &gt; 
           
  Success! </code></pre>
            <p>If you can’t see the question
            <code>Mark this class as an API Platform resource?</code>,
            don’t worry, we solve that soon.</p>
            <p>And do the migration:</p>
            <div class="sourceCode" id="cb22"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">symfony</span> console make:migration</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">symfony</span> console doctrine:migrations:migrate</span></code></pre></div>
            <p>Now, run the server and go to the url
            <code>http://127.0.0.1:8002/api</code>. You will see
            something similar to:</p>
            <figure>
            <img src="images/api_platform_01.png"
            alt="API Platform main page" />
            <figcaption aria-hidden="true">API Platform main
            page</figcaption>
            </figure>
            <p>As you can see, we have all the usual REST operations for
            the Category entity.</p>
            <p>But the Dish entity doesn’t appear. We can solve it
            easily editing the <code>Dish</code> class, importing the
            <code>ApiPlatform\Metadata\ApiResource</code> component and
            adding the attribute <code>#[ApiResource]</code> to the
            class:</p>
            <div class="sourceCode" id="cb23"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">A</span>piResource<span class="ot">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">E</span>ntity(repositoryClass<span class="ot">:</span> <span class="cn">D</span>ishRepository::<span class="kw">class</span>)<span class="at">]</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource<span class="at">]</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>Now, refresh the page and you will see the Category
            operations. Time for adding a few categories and dishes to
            doing tests. You can do that with Postman or directly in the
            API Platform page: open the
            <code>POST /api/categories</code> item -&gt; <em>Try it
            out</em> and enter the data for the categories you want (you
            don’t have to put anything in the <code>dishes</code>
            array):</p>
            <figure>
            <img src="images/api_platform_02.png"
            alt="API Platform POST" />
            <figcaption aria-hidden="true">API Platform
            POST</figcaption>
            </figure>
            <p>To do the operations <code>POST</code> and
            <code>PUT</code> in Postman, you need to stablish the
            <strong>content-type</strong> to
            <code>application/ld+json</code> in the Headers section:</p>
            <figure>
            <img src="images/postman_post_api_platform.png"
            alt="Header content-type" />
            <figcaption aria-hidden="true">Header
            content-type</figcaption>
            </figure>
            <p>Do the request as usual, but note that the price and the
            category are strings. For the category you also need to
            indicate the route:</p>
            <figure>
            <img src="images/postman_post_api_platform2.png"
            alt="POST to API Platform" />
            <figcaption aria-hidden="true">POST to API
            Platform</figcaption>
            </figure>
            <p>Check all the operations with Postman and the web
            interface. Note how now the GET responses are a bit
            different, because them include the JSON-LD
            (<code>@context</code>, <code>@id</code>,
            <code>@type</code>) and Hydra (<code>hydra:totalItems</code>
            and <code>hydra:member</code>) elements.</p>
            <p>Finally, go to the bottom of the page and inspect the
            JSON Schema created automatically by API Platform:</p>
            <figure>
            <img src="images/api-dish-schema.png"
            alt="JSON Schema of the Dish entity" />
            <figcaption aria-hidden="true">JSON Schema of the Dish
            entity</figcaption>
            </figure>
            <h2 data-number="3.3" id="modifying-the-api"><span
            class="header-section-number">3.3</span> Modifying the
            API</h2>
            <p>Probably you have noted that a new operation has
            appeared, PATCH. PATCH is similar to PUT but is intended for
            partial modifications. As PUT is also capable of doing that,
            we can remove PATCH from our API.</p>
            <p>To do that, we need to expand the information of the
            ApiResource attribute, adding only the operations we
            want:</p>
            <div class="sourceCode" id="cb24"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">A</span>piResource<span class="ot">;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">D</span>elete<span class="ot">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">G</span>et<span class="ot">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">G</span>etCollection<span class="ot">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">P</span>ost<span class="ot">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">P</span>ut<span class="ot">;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">E</span>ntity(repositoryClass<span class="ot">:</span> <span class="cn">D</span>ishRepository::<span class="kw">class</span>)<span class="at">]</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>et()<span class="ot">,</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>etCollection()<span class="ot">,</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ost()<span class="ot">,</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ut()<span class="ot">,</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">D</span>elete()<span class="ot">,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>)<span class="at">]</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>The same in the Category class.</p>
            <p>Now, we have only the selected operations.</p>
            <figure>
            <img src="images/basic_operations.png" width="400"
            alt="Basic operations" />
            <figcaption aria-hidden="true">Basic operations</figcaption>
            </figure>
            <p>We can also configure the operations. For instance in the
            next example, in the GET dishes by id operation, we can
            specify a different route with <code>uriTemplate</code> and
            we can require the id to be an integer with
            <code>requirements</code>:</p>
            <div class="sourceCode" id="cb25"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource(operations<span class="ot">:</span> [</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="cn">G</span>et(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    uriTemplate<span class="ot">:</span> <span class="st">&#39;/food/{id}&#39;</span><span class="ot">,</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    requirements<span class="ot">:</span> [<span class="st">&#39;id&#39;</span> =&gt; <span class="st">&#39;\d+&#39;</span>]<span class="ot">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)<span class="ot">,</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>If you want to prefix all routes to all operations, add
            the <code>routePrefix</code> attribute for the whole
            entity:</p>
            <div class="sourceCode" id="cb26"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource(routePrefix<span class="ot">:</span> <span class="st">&#39;/menu&#39;</span>)<span class="at">]</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>{</span></code></pre></div>
            <h2 data-number="3.4" id="serialization"><span
            class="header-section-number">3.4</span> Serialization</h2>
            <p>Another thing we can do is to hide some fields, or to
            make them read-only or write-only. To do that we need to
            know the concepts of serialization, normalization and
            de-normalization.</p>
            <p>Symfony uses <strong>serialization</strong> to convert
            entities (objects representing data in the application) into
            a format that can be easily transmitted via HTTP, such as
            JSON.</p>
            <p>Serialization in API Platform involves the following key
            concepts:</p>
            <ul>
            <li><p><strong>Normalization</strong>: The process of
            converting your data (objects or arrays) into a format
            suitable for serialization. It involves transforming data
            structures into JSON.</p></li>
            <li><p><strong>De-normalization</strong>: The reverse
            process of normalization, where the serialized data received
            from the client, in JSON format, is converted back into
            complex data structures within your application.</p></li>
            <li><p><strong>Context</strong>: The serialization and
            de-normalization processes can be influenced by a context
            that provides additional information or constraints. For
            example, you might want to include or exclude specific
            properties based on the API endpoint, user roles, or other
            conditions. The
            <strong><code>normalizationContext</code></strong> and
            <strong><code>denormalizationContext</code></strong> options
            in API Platform allow you to customize this
            behavior.</p></li>
            </ul>
            <p>To specify what groups to use in the API system:</p>
            <ol type="1">
            <li>Add the <code>normalizationContext</code> and
            <code>denormalizationContext</code> attributes to the
            resource, and specify which groups to use. Here you see that
            we add <em>read</em> and <em>write</em>, respectively, but
            you can use any group names you wish.</li>
            <li>Apply the groups to properties in the object.</li>
            </ol>
            <div class="sourceCode" id="cb27"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">S</span>erializer\<span class="cn">A</span>nnotation\<span class="cn">G</span>roups<span class="ot">;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    normalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;read&#39;</span>]<span class="at">]</span><span class="ot">,</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    denormalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;write&#39;</span>]]<span class="ot">,</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">C</span>ategory</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">I</span>d<span class="at">]</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">G</span>eneratedValue<span class="at">]</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn<span class="at">]</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span>])<span class="at">]</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">int</span> <span class="va">$id</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">100</span>)<span class="at">]</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span>])<span class="at">]</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">255</span><span class="ot">,</span> nullable<span class="ot">:</span> <span class="kw">true</span>)<span class="at">]</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span>])<span class="at">]</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$description</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">O</span>neToMany(mappedBy<span class="ot">:</span> <span class="st">&#39;category&#39;</span><span class="ot">,</span> targetEntity<span class="ot">:</span> <span class="cn">D</span>ish::<span class="kw">class</span>)<span class="at">]</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="cn">C</span>ollection <span class="va">$dishes</span><span class="ot">;</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div>
            <p>In the previous example, we have created the
            <em>read</em> group for normalization (when we transform our
            data to JSON), and the <em>write</em> group for
            de-normalization (when we transform our JSON to data to
            entities). Then we’ve applied the groups to all the
            properties except for <code>$dishes</code>. If you go to the
            Swagger UI and do any operation you will see that the
            <code>$dishes</code> array doesn’t appear. If you want to
            see the array only in the get operations, simply add the
            <code>#[Groups(['read'])]</code> attribute to
            <code>$dishes</code>.</p>
            <h2 data-number="3.5" id="documenting-the-api"><span
            class="header-section-number">3.5</span> Documenting the
            API</h2>
            <p>The Swagger interface also works as a documentation page.
            We can add annotation comments to our classes and they will
            be visible on the frontend.</p>
            <p>For instance, add the next comments to the Category
            class:</p>
            <div class="sourceCode" id="cb28"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">* The name of the category</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">100</span>)<span class="at">]</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">* The category description</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">255</span><span class="ot">,</span> nullable<span class="ot">:</span> <span class="kw">true</span>)<span class="at">]</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$description</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">* A list with the dishes of each category</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">O</span>neToMany(mappedBy<span class="ot">:</span> <span class="st">&#39;category&#39;</span><span class="ot">,</span> targetEntity<span class="ot">:</span> <span class="cn">D</span>ish::<span class="kw">class</span>)<span class="at">]</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="cn">C</span>ollection <span class="va">$dishes</span><span class="ot">;</span></span></code></pre></div>
            <p>Now the descriptions appear on the Schema section:</p>
            <figure>
            <img src="images/schema-category.png" width="350"
            alt="Schema comments" />
            <figcaption aria-hidden="true">Schema comments</figcaption>
            </figure>
            <p>We can also describe each class adding a description
            element to the <code>ApiResource</code> attribute:</p>
            <div class="sourceCode" id="cb29"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>et()<span class="ot">,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>etCollection()<span class="ot">,</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ost()<span class="ot">,</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ut()<span class="ot">,</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">D</span>elete()<span class="ot">,</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    description<span class="ot">:</span> <span class="st">&#39;Categories of meals&#39;</span><span class="ot">,</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)<span class="at">]</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">C</span>ategory</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <figure>
            <img src="images/class_description.png"
            alt="Class description" />
            <figcaption aria-hidden="true">Class
            description</figcaption>
            </figure>
            <h2 data-number="3.6" id="subresources"><span
            class="header-section-number">3.6</span> Subresources</h2>
            <p>When you do a GET operation for <code>/api/dishes</code>,
            you get something like:</p>
            <div class="sourceCode" id="cb30"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;/api/menu/food/1&quot;</span><span class="fu">,</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Dish&quot;</span><span class="fu">,</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Pepperoni pizza&quot;</span><span class="fu">,</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;ingredients&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozzarella, pepperoni, etc&quot;</span><span class="fu">,</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;10.50&quot;</span><span class="fu">,</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;category&quot;</span><span class="fu">:</span> <span class="st">&quot;/api/categories/1&quot;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>But, what does mean <code>"/api/categories/1"</code>? It
            will be better if we could see the category name instead of
            their route.</p>
            <p>It is possible to embed related objects (or only some of
            their properties) directly in the parent response through
            the use of serialization groups. By using the following
            serialization groups attribute (#[Groups]), a JSON
            representation of the category is embedded in the dish
            response. As soon as any of the category’s attributes is in
            the dish group, the category will be embedded:</p>
            <div class="sourceCode" id="cb31"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// entity/Dish</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    normalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;dish&#39;</span>]<span class="at">]</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups(<span class="st">&#39;dish&#39;</span>)<span class="at">]</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">int</span> <span class="va">$id</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups(<span class="st">&#39;dish&#39;</span>)<span class="at">]</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups(<span class="st">&#39;dish&#39;</span>)<span class="at">]</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$ingredients</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups(<span class="st">&#39;dish&#39;</span>)<span class="at">]</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$price</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups(<span class="st">&#39;dish&#39;</span>)<span class="at">]</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="cn">C</span>ategory <span class="va">$category</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co">//entity/Category</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    normalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;read&#39;</span>]<span class="at">]</span><span class="ot">,</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    denormalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;write&#39;</span>]]<span class="ot">,</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">C</span>ategory</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">..</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span>])<span class="at">]</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">int</span> <span class="va">$id</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span><span class="ot">,</span> <span class="st">&#39;dish&#39;</span>])<span class="at">]</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;read&#39;</span><span class="ot">,</span> <span class="st">&#39;write&#39;</span><span class="ot">,</span> <span class="st">&#39;dish&#39;</span>])<span class="at">]</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$description</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div>
            <p>Now, you can get the category name and description for
            each dish:</p>
            <div class="sourceCode" id="cb32"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;/api/menu/food/1&quot;</span><span class="fu">,</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Dish&quot;</span><span class="fu">,</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Pepperoni pizza&quot;</span><span class="fu">,</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;ingredients&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozzarella, pepperoni, etc&quot;</span><span class="fu">,</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;10.50&quot;</span><span class="fu">,</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;category&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;@id&quot;</span><span class="fu">:</span> <span class="st">&quot;/api/categories/1&quot;</span><span class="fu">,</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Category&quot;</span><span class="fu">,</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Pizzas&quot;</span><span class="fu">,</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;Delicious Italian pizzas&quot;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>Another way to visualize related entities is creating a
            new route in which we can get the entities related by
            another.</p>
            <p>In our example we are going to make a new route to show
            all the dishes related to a category. The route will be
            <code>/categories/{id}/dishes</code>:</p>
            <div class="sourceCode" id="cb33"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Entity/Dish</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="fu">Link</span><span class="ot">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    uriTemplate<span class="ot">:</span> <span class="st">&#39;/categories/{id}/dishes&#39;</span><span class="ot">,</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [ <span class="kw">new</span> <span class="cn">G</span>etCollection() ]<span class="ot">,</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    uriVariables<span class="ot">:</span> [</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;id&#39;</span> =&gt; <span class="kw">new</span> <span class="fu">Link</span>(fromClass<span class="ot">:</span> <span class="cn">C</span>ategory::<span class="kw">class</span><span class="ot">,</span> toProperty<span class="ot">:</span> <span class="st">&#39;category&#39;</span>)<span class="ot">,</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>)<span class="at">]</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>We use the <code>uriTemplate</code> attribute to create
            the route, <code>operations</code> to specify that we want
            to get a collection of dishes and <code>uriVariables</code>
            to link the Category class to the category property in Dish.
            If you go to the route
            <code>/api/categories/2/dishes</code>, for instance, you’ll
            get all the dishes of the category with id 2.</p>
            <h2 data-number="3.7" id="filters"><span
            class="header-section-number">3.7</span> Filters</h2>
            <p>We can use the Api Platform filters to search specific
            data in our api.</p>
            <p>To use them, we can add the ApiFilter attribute and the
            required dependencies:</p>
            <div class="sourceCode" id="cb34"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">A</span>piResource<span class="ot">;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">A</span>piFilter<span class="ot">;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">D</span>octrine\<span class="cn">O</span>rm\<span class="cn">F</span>ilter\<span class="cn">S</span>earchFilter<span class="ot">;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="op">..</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piFilter(<span class="cn">S</span>earchFilter::<span class="kw">class</span><span class="ot">,</span> properties<span class="ot">:</span> [<span class="st">&#39;name&#39;</span> =&gt; <span class="st">&#39;partial&#39;</span>])<span class="at">]</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <p>With this code we can search by a custom string in the
            <code>name</code> property. For example, if we go to the GET
            <code>/api/dishes</code> request in the Swagger fronten, we
            can find a new field for searching in the <code>name</code>
            property:</p>
            <figure>
            <img src="images/api_platform_03.png" alt="Search filter" />
            <figcaption aria-hidden="true">Search filter</figcaption>
            </figure>
            <p>If we write <code>pizza</code>, we retrieve all the
            dishes with the <code>pizza</code> string in their name.</p>
            <p>If we want to use the api endpoint directly, we can write
            the query in the query string:</p>
            <pre><code>http://127.0.0.1:8000/api/dishes?name=pizza</code></pre>
            <p>The search filter supports <strong>exact</strong>,
            <strong>partial</strong>, <strong>start</strong>,
            <strong>end</strong>, and <strong>word_start</strong>
            matching strategies:</p>
            <ul>
            <li><strong>exact</strong> searches for fields with the
            exact string.</li>
            <li><strong>partial</strong> strategy uses
            <code>LIKE %text%</code> to search for fields that contain
            text.</li>
            <li><strong>start</strong> strategy uses
            <code>LIKE text%</code> to search for fields that start with
            <strong>text</strong>.</li>
            <li>end strategy uses <code>LIKE %text</code> to search for
            fields that end with text.</li>
            <li><strong>word_start</strong> strategy uses
            <code>LIKE text% OR LIKE % text%</code> to search for fields
            that contain words starting with text.</li>
            </ul>
            <p>In MySQl the commonly used <strong>utf8_unicode_ci
            collation</strong> (or <strong>utf8mb4_unicode_ci</strong>)
            performs case-insensitive searches by default.</p>
            <p>We can specify several search filters:</p>
            <div class="sourceCode" id="cb36"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piFilter(<span class="cn">S</span>earchFilter::<span class="kw">class</span><span class="ot">,</span> properties<span class="ot">:</span> [<span class="st">&#39;name&#39;</span> =&gt; <span class="st">&#39;partial&#39;</span><span class="ot">,</span> <span class="st">&#39;ingredients&#39;</span> =&gt; <span class="st">&#39;partial&#39;</span>])<span class="at">]</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span></code></pre></div>
            <p>And for searching:</p>
            <pre><code>http://127.0.0.1:8000/api/dishes?name=pizza&amp;ingredients=mozzarella</code></pre>
            <p>We also have <strong>date</strong>,
            <strong>boolean</strong> and <strong>numeric</strong>
            filters for searching with these types:</p>
            <p><a
            href="https://api-platform.com/docs/core/doctrine-filters/">Api
            Platform Doctrine filters</a></p>
            <p>The <strong>order filter</strong> allows sorting a
            collection against the given properties:</p>
            <div class="sourceCode" id="cb38"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">D</span>octrine\<span class="cn">O</span>rm\<span class="cn">F</span>ilter\<span class="cn">O</span>rderFilter<span class="ot">;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piFilter(<span class="cn">O</span>rderFilter::<span class="kw">class</span><span class="ot">,</span> properties<span class="ot">:</span> [<span class="st">&#39;name&#39;</span><span class="ot">,</span> <span class="st">&#39;ingredients&#39;</span>])<span class="at">]</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
            <pre><code>http://127.0.0.1:8000/api/dishes?order[name]=asc&amp;order[ingredients]=desc</code></pre>
            <p>More about <a
            href="https://api-platform.com/docs/core/doctrine-filters/#order-filter-sorting">order
            filters</a>.</p>
            <h2 data-number="3.8" id="validation-1"><span
            class="header-section-number">3.8</span> Validation</h2>
            <p>API Platform takes care of validating the data sent to
            the API, relying on the Symfony Validator Component. As the
            validator package is included with API Platform, we only
            need to add the library and the asserts to each class:</p>
            <div class="sourceCode" id="cb40"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">V</span>alidator\<span class="cn">C</span>onstraints <span class="kw">as</span> <span class="fu">Assert</span><span class="ot">;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">100</span>)<span class="at">]</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">N</span>otBlank<span class="at">]</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span></code></pre></div>
            <p>If you try to post a category with an empty name, you
            will get an error message generated by the validator:</p>
            <figure>
            <img src="images/error-validation.png" width="450"
            alt="Validation error" />
            <figcaption aria-hidden="true">Validation error</figcaption>
            </figure>
            <p>Write the next asserts in the Dish class and check them
            sending data with POST and PUT:</p>
            <div class="sourceCode" id="cb41"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">N</span>otBlank<span class="at">]</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$name</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">T</span>ype(<span class="st">&#39;numeric&#39;</span>)<span class="at">]</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">P</span>ositiveOrZero<span class="at">]</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$price</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">N</span>otBlank<span class="at">]</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="ot">?</span><span class="cn">C</span>ategory <span class="va">$category</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span></code></pre></div>
            <h1 data-number="4" id="security"><span
            class="header-section-number">4</span> Security</h1>
            <p>Symfony’s security system is very powerful and versatile,
            although it can also be complicated to understand and
            configure. In this unit we will learn its main elements:</p>
            <ul>
            <li>The <strong>authentication mechanism</strong>: how the
            users can access the app and where their credentials are
            stored.</li>
            <li>The <strong>authorization mechanism</strong>: once the
            user has been logged in correctly, determine their
            permissions and what resources can access and which
            can’t.</li>
            </ul>
            <h2 data-number="4.1" id="the-security.yaml-file"><span
            class="header-section-number">4.1</span> The
            <em>security.yaml</em> file</h2>
            <p>The <code>config/packages/security.yaml</code> file
            stores the general configuration of the security system of
            our Symfony application. Its default content is:</p>
            <div class="sourceCode" id="cb42"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">security</span><span class="kw">:</span><span class="at">    </span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">providers</span><span class="kw">:</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">users_in_memory</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span><span class="at"> </span><span class="kw">}</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">firewalls</span><span class="kw">:</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">pattern</span><span class="kw">:</span><span class="at"> ^/(_(profiler|wdt)|css|images|js)/</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">security</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">main</span><span class="kw">:</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">lazy</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> users_in_memory</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="at">            </span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">access_control</span><span class="kw">:</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">        # - { path: ^/admin, roles: ROLE_ADMIN }</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">        # - { path: ^/profile, roles: ROLE_USER }</span></span></code></pre></div>
            <p>Their main sections are:</p>
            <ul>
            <li>The User <strong>providers</strong>: The user provider
            loads users from any storage (e.g. the database) based on a
            “user identifier” (e.g. the user’s email address).</li>
            <li>The <strong>Firewall</strong>: The firewall is the core
            of securing your application. Every request within the
            firewall is checked if it needs an authenticated user. The
            firewall also takes care of authenticating this user
            (e.g. using a login form).</li>
            <li><strong>Access Control</strong> (Authorization): Using
            access control and authorization, you control the required
            permissions to perform a specific action or visit a specific
            URL.</li>
            </ul>
            <h2 data-number="4.2" id="the-user"><span
            class="header-section-number">4.2</span> The User</h2>
            <p>Permissions in Symfony are always linked to a
            <strong>user</strong> object. If you need to secure your
            application, you need to create a user class. This is a
            class that implements <code>UserInterface</code>. This is
            often a Doctrine entity.</p>
            <p>The easiest way to generate a user class is using the
            make:user command from the MakerBundle:</p>
            <pre class="console"><code>symfony console make:user
 The name of the security user class (e.g. User) [User]:
 &gt; User

 Do you want to store user data in the database (via Doctrine)? (yes/no) [yes]:
 &gt; yes

 Enter a property name that will be the unique &quot;display&quot; name for the user (e.g. email, username, uuid) [email]:
 &gt; email

 Will this app need to hash/check user passwords? Choose No if passwords are not needed or will be checked/hashed by some other system (e.g. a single sign-on server).

 Does this app need to hash/check user passwords? (yes/no) [yes]:
 &gt; yes

 created: src/Entity/User.php
 created: src/Repository/UserRepository.php
 updated: src/Entity/User.php
 updated: config/packages/security.yaml</code></pre>
            <p>This is the normal procedure: we tell to the maker the
            <strong>user class name</strong>
            (<strong><em>User</em></strong>), if we want to store the
            user’s data in the database via Doctrine
            (<strong><em>yes</em></strong>), the field used to login or
            display name (<strong><em>‘email’</em></strong>) and if the
            system must hash the password before store it
            (<strong><em>yes</em></strong>).</p>
            <p>Once finished the process, the maker has created 2 files,
            <code>src/Entity/User.php</code> and
            <code>src/Repository/UserRepository.php</code>, and has
            updated the <code>providers</code> section in the
            <code>security.yaml</code> reflecting the new users
            provider:</p>
            <div class="sourceCode" id="cb44"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">providers</span><span class="kw">:</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app_user_provider</span><span class="kw">:</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">entity</span><span class="kw">:</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">class</span><span class="kw">:</span><span class="at"> App\Entity\User</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">property</span><span class="kw">:</span><span class="at"> email</span></span></code></pre></div>
            <p>Now, the system knows which class must be used to store
            and to check users (<em><code>App\Entity\User</code></em>)
            and which property is used to identify the user
            (<em><code>email</code></em>).</p>
            <p>User providers are used in a couple places during the
            security lifecycle:</p>
            <ul>
            <li><strong>Load the User based on an identifier</strong>:
            During login, the provider loads the user based on the user
            id.</li>
            <li><strong>Reload the User from the session</strong>: At
            the beginning of each request, the user is loaded from the
            session. The provider “refreshes” the user from the database
            to make sure all user information is up to date.</li>
            </ul>
            <p>Once created the <code>User</code> class, the next step
            is to do the migration process. But before, you can add more
            properties to the class, such as name, surname, address,
            phone, etc, with
            <code>symfony console make:entity User</code> and telling
            the assistant the new properties you want.</p>
            <p>If your class is OK, do the migration progress as
            usual:</p>
            <div class="sourceCode" id="cb45"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">symfony</span> console make:migration</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">symfony</span> console doctrine:migrations:migrate</span></code></pre></div>
            <p>And the table <code>user</code> will be created in the
            database:</p>
            <div class="sourceCode" id="cb46"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mysql<span class="op">&gt;</span> describe <span class="fu">user</span>;</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>| Field    | <span class="kw">Type</span>         | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>| <span class="kw">id</span>       | <span class="dt">int</span>          | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>| email    | <span class="dt">varchar</span>(<span class="dv">180</span>) | <span class="kw">NO</span>   | UNI | <span class="kw">NULL</span>    |                |</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>| <span class="kw">roles</span>    | json         | <span class="kw">NO</span>   |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>| <span class="kw">password</span> | <span class="dt">varchar</span>(<span class="dv">255</span>) | <span class="kw">NO</span>   |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="op">+</span><span class="co">----------+--------------+------+-----+---------+----------------+</span></span></code></pre></div>
            <blockquote>
            <p>In MariaDB the <code>roles</code> field is done as a
            <code>longtext</code> type instead of <code>json</code>, but
            it works in the same way.</p>
            </blockquote>
            <h3 data-number="4.2.1" id="hashing-passwords"><span
            class="header-section-number">4.2.1</span> Hashing
            Passwords</h3>
            <p>The <em>SecurityBundle</em> provides password hashing and
            verification functionality. If you have created your user as
            shown before, your user class should implement the
            <code>PasswordAuthenticatedUserInterface</code>:</p>
            <div class="sourceCode" id="cb47"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">S</span>ecurity\<span class="cn">C</span>ore\<span class="cn">U</span>ser\<span class="cn">P</span>asswordAuthenticatedUserInterface<span class="ot">;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">U</span>ser <span class="kw">implements</span> <span class="cn">U</span>serInterface<span class="ot">,</span> <span class="cn">P</span>asswordAuthenticatedUserInterface {</span></code></pre></div>
            <p>And your <code>security.yaml</code> file should have been
            configured:</p>
            <div class="sourceCode" id="cb48"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">security</span><span class="kw">:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">password_hashers</span><span class="kw">:</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;auto&#39;</span></span></code></pre></div>
            <h2 data-number="4.3" id="token-based-authentication"><span
            class="header-section-number">4.3</span> Token based
            authentication</h2>
            <p>Traditional authentication mechanisms in web apps are
            based on sessions: the user submits his credentials through
            some form, the server validates and stores the data of the
            logged in user in the session, so that, while the session
            doesn’t expire or isn’t closed by the user, they can
            continue accessing without having to re-login.</p>
            <p>However, this type of authentication has the limitation
            of being exclusive to web applications. If we want to adapt
            the application to mobile or desktop versions, we need
            another mechanism.</p>
            <p>To get over this, we can use <strong>token-based
            authentication</strong>. This is a <em>stateless</em>
            authentication, which means that nothing is stored between
            client and server to continue accessing authenticated (no
            sessions). What is done is the following:</p>
            <ol type="1">
            <li>The client sends to the server its credentials (username
            and password).</li>
            <li>The server validates them, and if they are correct,
            generates an encrypted string called <strong>token</strong>,
            which contains the user’s validation, plus some additional
            information (such as the user’s login, for example). This
            token is sent back to the user as a response to their
            authentication.</li>
            <li>From this point on, whenever the client wants to
            authenticate against the server to request a resource, it
            needs to send the provided token. The server will verify it
            and grant or deny access.</li>
            </ol>
            <p>Like sessions, tokens can also expire, which is indicated
            within the token itself. After the expiration time, if the
            server receives the token, it will discard it as invalid
            (expired), and the client will again be unauthenticated.</p>
            <p>A JWT token has the next components:</p>
            <ul>
            <li><strong>Header</strong>: has two parts, the type of the
            token, which is JWT, and the signing algorithm being used,
            such as HMAC SHA256 or RSA.</li>
            <li><strong>Payload</strong>: the data encoded in
            Base64Url.</li>
            <li><strong>Signature</strong>: created with the encoded
            header, the encoded payload, a secret and the algorithm
            specified in the header.</li>
            </ul>
            <p>You can see an example of a JWT token in <a
            href="https://jwt.io/">https://jwt.io/</a></p>
            <h2 data-number="4.4" id="configuring-the-api"><span
            class="header-section-number">4.4</span> Configuring the
            API</h2>
            <p>We will use the <a
            href="https://packagist.org/packages/lexik/jwt-authentication-bundle">lexik/jwt-authentication-bundle</a>.
            Install it with composer:</p>
            <div class="sourceCode" id="cb49"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">composer</span> require <span class="st">&quot;lexik/jwt-authentication-bundle&quot;</span></span></code></pre></div>
            <blockquote>
            <p>In Linux, you probably need the <strong>php
            sodium</strong> extension.</p>
            </blockquote>
            <p>Then, generate the SSL keys:</p>
            <div class="sourceCode" id="cb50"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">symfony</span> console lexik:jwt:generate-keypair</span></code></pre></div>
            <p>The keys will be stored in
            <code>config/jwt/private.pem</code> and
            <code>config/jwt/public.pem</code>. Check that they are also
            in the <code>.gitignore</code> file for security
            reasons.</p>
            <p>Next, move the SSL keys paths and passphrase from your
            <code>.env</code> file to your <code>.env.local</code> file
            for the same reason:</p>
            <pre><code>JWT_SECRET_KEY=%kernel.project_dir%/config/jwt/private.pem
JWT_PUBLIC_KEY=%kernel.project_dir%/config/jwt/public.pem
JWT_PASSPHRASE=autogenerated_passphrase</code></pre>
            <p>And write in
            <code>config/packages/lexik_jwt_authentication.yaml</code>:</p>
            <div class="sourceCode" id="cb52"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lexik_jwt_authentication</span><span class="kw">:</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">secret_key</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;%env(resolve:JWT_SECRET_KEY)%&#39;</span><span class="co"> # required for token creation</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">public_key</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;%env(resolve:JWT_PUBLIC_KEY)%&#39;</span><span class="co"> # required for token verification</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">pass_phrase</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;%env(JWT_PASSPHRASE)%&#39;</span><span class="co"> # required for token creation</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">token_ttl</span><span class="kw">:</span><span class="at"> </span><span class="dv">3600</span><span class="co"> # ttl (duration) in seconds, default is 3600</span></span></code></pre></div>
            <p>To configure the API security firewalls in
            <code>security.yaml</code>, we need to place the
            <code>api</code> and the <code>main</code> firewalls as
            shown below:</p>
            <div class="sourceCode" id="cb53"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">firewalls</span><span class="kw">:</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dev</span><span class="kw">:</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">pattern</span><span class="kw">:</span><span class="at"> ^/(_(profiler|wdt)|css|images|js)/</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">security</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">api</span><span class="kw">:</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">pattern</span><span class="kw">:</span><span class="at"> ^/api/</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">stateless</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> app_user_provider</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">jwt</span><span class="kw">:</span><span class="at"> </span><span class="ch">~</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">main</span><span class="kw">:</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">json_login</span><span class="kw">:</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">check_path</span><span class="kw">:</span><span class="at"> auth </span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">username_path</span><span class="kw">:</span><span class="at"> email</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">password_path</span><span class="kw">:</span><span class="at"> password</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">success_handler</span><span class="kw">:</span><span class="at"> lexik_jwt_authentication.handler.authentication_success</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">failure_handler</span><span class="kw">:</span><span class="at"> lexik_jwt_authentication.handler.authentication_failure</span></span></code></pre></div>
            <p>And, in the <code>access_control</code> section of the
            same file:</p>
            <div class="sourceCode" id="cb54"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">access_control</span><span class="kw">:</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ^/api$</span><span class="kw">,</span><span class="at"> </span><span class="fu">roles</span><span class="kw">:</span><span class="at"> PUBLIC_ACCESS </span><span class="kw">}</span><span class="co"> # Allows accessing the Swagger UI</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ^/auth</span><span class="kw">,</span><span class="at"> </span><span class="fu">roles</span><span class="kw">:</span><span class="at"> PUBLIC_ACCESS </span><span class="kw">}</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ^/api/users$</span><span class="kw">,</span><span class="at"> </span><span class="fu">roles</span><span class="kw">:</span><span class="at"> PUBLIC_ACCESS</span><span class="kw">,</span><span class="at"> </span><span class="fu">methods</span><span class="kw">:</span><span class="at"> POST </span><span class="kw">}</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="kw">{</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ^/</span><span class="kw">,</span><span class="at"> </span><span class="fu">roles</span><span class="kw">:</span><span class="at"> IS_AUTHENTICATED_FULLY </span><span class="kw">}</span></span></code></pre></div>
            <p>You must also declare the route used for
            <code>/auth</code> in <code>config/routes.yaml</code>:</p>
            <div class="sourceCode" id="cb55"><pre
            class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auth</span><span class="kw">:</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /auth</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">methods</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;POST&#39;</span><span class="kw">]</span></span></code></pre></div>
            <p>With these paths any user can acces to the Swagger
            frontend and to the <code>/auth</code> path, but if you try
            to acces any path of the API, you’ll get the response:</p>
            <div class="sourceCode" id="cb56"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="dv">401</span><span class="fu">,</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;JWT Token not found&quot;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <h2 data-number="4.5" id="registering-users"><span
            class="header-section-number">4.5</span> Registering
            users</h2>
            <p>If you go the the new path http://localhost:8000/auth
            (using Postman) and enter an email and a password, you’ll
            get the response:</p>
            <div class="sourceCode" id="cb57"><pre
            class="sourceCode json"><code class="sourceCode json"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="dv">401</span><span class="fu">,</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Invalid credentials.&quot;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
            <p>This is because we don’t have any registered user. We
            need to modify the <code>User</code> entity to allow
            registrations through it:</p>
            <div class="sourceCode" id="cb58"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># api/src/Entity/User.php</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">E</span>ntity<span class="ot">;</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">A</span>piResource<span class="ot">;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">P</span>ost<span class="ot">;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">P</span>ut<span class="ot">;</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">D</span>octrine\<span class="cn">ORM</span>\<span class="cn">M</span>apping <span class="kw">as</span> <span class="cn">ORM</span><span class="ot">;</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>pp\<span class="cn">R</span>epository\<span class="cn">U</span>serRepository<span class="ot">;</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>pp\<span class="cn">S</span>tate\<span class="cn">U</span>serPasswordHasher<span class="ot">;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">B</span>ridge\<span class="cn">D</span>octrine\<span class="cn">V</span>alidator\<span class="cn">C</span>onstraints\<span class="cn">U</span>niqueEntity<span class="ot">;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">S</span>ecurity\<span class="cn">C</span>ore\<span class="cn">U</span>ser\<span class="cn">P</span>asswordAuthenticatedUserInterface<span class="ot">;</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">S</span>ecurity\<span class="cn">C</span>ore\<span class="cn">U</span>ser\<span class="cn">U</span>serInterface<span class="ot">;</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">S</span>erializer\<span class="cn">A</span>nnotation\<span class="cn">G</span>roups<span class="ot">;</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">V</span>alidator\<span class="cn">C</span>onstraints <span class="kw">as</span> <span class="fu">Assert</span><span class="ot">;</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource(</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ost(processor<span class="ot">:</span> <span class="cn">U</span>serPasswordHasher::<span class="kw">class</span><span class="ot">,</span> validationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;Default&#39;</span><span class="ot">,</span> <span class="st">&#39;user:create&#39;</span>]<span class="at">]</span>)<span class="ot">,</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ut(processor<span class="ot">:</span> <span class="cn">U</span>serPasswordHasher::<span class="kw">class</span>)<span class="ot">,</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    normalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;user:read&#39;</span>]]<span class="ot">,</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    denormalizationContext<span class="ot">:</span> [<span class="st">&#39;groups&#39;</span> =&gt; [<span class="st">&#39;user:create&#39;</span><span class="ot">,</span> <span class="st">&#39;user:update&#39;</span>]]<span class="ot">,</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">E</span>ntity(repositoryClass<span class="ot">:</span> <span class="cn">U</span>serRepository::<span class="kw">class</span>)<span class="at">]</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">T</span>able(name<span class="ot">:</span> <span class="st">&#39;`user`&#39;</span>)<span class="at">]</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">U</span>niqueEntity(<span class="st">&#39;email&#39;</span>)<span class="at">]</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">U</span>ser <span class="kw">implements</span> <span class="cn">U</span>serInterface<span class="ot">,</span> <span class="cn">P</span>asswordAuthenticatedUserInterface</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;user:read&#39;</span>])<span class="at">]</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">I</span>d<span class="at">]</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(type<span class="ot">:</span> <span class="st">&#39;integer&#39;</span>)<span class="at">]</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">G</span>eneratedValue<span class="at">]</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">int</span> <span class="va">$id</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">N</span>otBlank<span class="at">]</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">E</span>mail<span class="at">]</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;user:read&#39;</span><span class="ot">,</span> <span class="st">&#39;user:create&#39;</span><span class="ot">,</span> <span class="st">&#39;user:update&#39;</span>])<span class="at">]</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(length<span class="ot">:</span> <span class="dv">180</span><span class="ot">,</span> unique<span class="ot">:</span> <span class="kw">true</span>)<span class="at">]</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$email</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn<span class="at">]</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$password</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="fu">Assert</span>\<span class="cn">N</span>otBlank(groups<span class="ot">:</span> [<span class="st">&#39;user:create&#39;</span>])<span class="at">]</span></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">G</span>roups([<span class="st">&#39;user:create&#39;</span><span class="ot">,</span> <span class="st">&#39;user:update&#39;</span>])<span class="at">]</span></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="ot">?</span><span class="dt">string</span> <span class="va">$plainPassword</span> <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span><span class="cn">ORM</span>\<span class="cn">C</span>olumn(type<span class="ot">:</span> <span class="st">&#39;json&#39;</span>)<span class="at">]</span></span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">array</span> <span class="va">$roles</span> <span class="op">=</span> []<span class="ot">;</span></span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getId()<span class="ot">:</span> <span class="ot">?</span><span class="dt">int</span></span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;id<span class="ot">;</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getEmail()<span class="ot">:</span> <span class="ot">?</span><span class="dt">string</span></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;email<span class="ot">;</span></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> setEmail(<span class="dt">string</span> <span class="va">$email</span>)<span class="ot">:</span> <span class="kw">self</span></span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;email <span class="op">=</span> <span class="va">$email</span><span class="ot">;</span></span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span><span class="ot">;</span></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@see</span><span class="co"> PasswordAuthenticatedUserInterface</span></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getPassword()<span class="ot">:</span> <span class="dt">string</span></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;password<span class="ot">;</span></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> setPassword(<span class="dt">string</span> <span class="va">$password</span>)<span class="ot">:</span> <span class="kw">self</span></span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;password <span class="op">=</span> <span class="va">$password</span><span class="ot">;</span></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span><span class="ot">;</span></span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getPlainPassword()<span class="ot">:</span> <span class="ot">?</span><span class="dt">string</span></span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;plainPassword<span class="ot">;</span></span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> setPlainPassword(<span class="ot">?</span><span class="dt">string</span> <span class="va">$plainPassword</span>)<span class="ot">:</span> <span class="kw">self</span></span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;plainPassword <span class="op">=</span> <span class="va">$plainPassword</span><span class="ot">;</span></span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span><span class="ot">;</span></span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@see</span><span class="co"> UserInterface</span></span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getRoles()<span class="ot">:</span> <span class="dt">array</span></span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a>        <span class="va">$roles</span> <span class="op">=</span> <span class="va">$this</span>-&gt;roles<span class="ot">;</span></span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a>        <span class="va">$roles</span>[] <span class="op">=</span> <span class="st">&#39;ROLE_USER&#39;</span><span class="ot">;</span></span>
<span id="cb58-105"><a href="#cb58-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-106"><a href="#cb58-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">array_unique</span>(<span class="va">$roles</span>)<span class="ot">;</span></span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> setRoles(<span class="dt">array</span> <span class="va">$roles</span>)<span class="ot">:</span> <span class="kw">self</span></span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-111"><a href="#cb58-111" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;roles <span class="op">=</span> <span class="va">$roles</span><span class="ot">;</span></span>
<span id="cb58-112"><a href="#cb58-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-113"><a href="#cb58-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span><span class="ot">;</span></span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb58-117"><a href="#cb58-117" aria-hidden="true" tabindex="-1"></a><span class="co">     * A visual identifier that represents this user.</span></span>
<span id="cb58-118"><a href="#cb58-118" aria-hidden="true" tabindex="-1"></a><span class="co">     *</span></span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@see</span><span class="co"> UserInterface</span></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> getUserIdentifier()<span class="ot">:</span> <span class="dt">string</span></span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dt">(string)</span> <span class="va">$this</span>-&gt;email<span class="ot">;</span></span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@see</span><span class="co"> UserInterface</span></span>
<span id="cb58-128"><a href="#cb58-128" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb58-129"><a href="#cb58-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> eraseCredentials()<span class="ot">:</span> <span class="dt">void</span></span>
<span id="cb58-130"><a href="#cb58-130" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-131"><a href="#cb58-131" aria-hidden="true" tabindex="-1"></a>        <span class="va">$this</span>-&gt;plainPassword <span class="op">=</span> <span class="kw">null</span><span class="ot">;</span></span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>The key concepts of the modification are:</p>
            <ul>
            <li>In the POST and PUT operations, we use a processor
            called <code>UserPasswordHasher</code>. This processor will
            catch the data in these operations and process them to hash
            the plain text password.</li>
            <li>We only expose the fields <code>email</code> and
            <code>plainPassword</code>.</li>
            </ul>
            <p>Next, in <code>src/State</code>, create the processor
            <code>UserPasswordHasher.php</code> :</p>
            <div class="sourceCode" id="cb59"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;?php</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># api/src/State/UserPasswordHasher.php</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">S</span>tate<span class="ot">;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">M</span>etadata\<span class="cn">O</span>peration<span class="ot">;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>piPlatform\<span class="cn">S</span>tate\<span class="cn">P</span>rocessorInterface<span class="ot">;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">S</span>ymfony\<span class="cn">C</span>omponent\<span class="cn">P</span>asswordHasher\<span class="cn">H</span>asher\<span class="cn">U</span>serPasswordHasherInterface<span class="ot">;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="kw">class</span> <span class="cn">U</span>serPasswordHasher <span class="kw">implements</span> <span class="cn">P</span>rocessorInterface</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> <span class="bu">__construct</span>(<span class="kw">private</span> <span class="dt">readonly</span> <span class="cn">P</span>rocessorInterface <span class="va">$processor</span><span class="ot">,</span> <span class="kw">private</span> <span class="dt">readonly</span> <span class="cn">U</span>serPasswordHasherInterface <span class="va">$passwordHasher</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> process(<span class="va">$data</span><span class="ot">,</span> <span class="cn">O</span>peration <span class="va">$operation</span><span class="ot">,</span> <span class="dt">array</span> <span class="va">$uriVariables</span> <span class="op">=</span> []<span class="ot">,</span> <span class="dt">array</span> <span class="va">$context</span> <span class="op">=</span> [])</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="va">$data</span>-&gt;getPlainPassword()) {</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">$this</span>-&gt;processor-&gt;process(<span class="va">$data</span><span class="ot">,</span> <span class="va">$operation</span><span class="ot">,</span> <span class="va">$uriVariables</span><span class="ot">,</span> <span class="va">$context</span>)<span class="ot">;</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">$hashedPassword</span> <span class="op">=</span> <span class="va">$this</span>-&gt;passwordHasher-&gt;hashPassword(</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">$data</span><span class="ot">,</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">$data</span>-&gt;getPlainPassword()</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>        )<span class="ot">;</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">$data</span>-&gt;setPassword(<span class="va">$hashedPassword</span>)<span class="ot">;</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">$data</span>-&gt;eraseCredentials()<span class="ot">;</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;processor-&gt;process(<span class="va">$data</span><span class="ot">,</span> <span class="va">$operation</span><span class="ot">,</span> <span class="va">$uriVariables</span><span class="ot">,</span> <span class="va">$context</span>)<span class="ot">;</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
            <p>This processor captures the data sent to the server and
            takes the <code>plainPassword</code> field to generate a
            hashed password, which is stored in the
            <code>password</code> field. Finally, deletes the plain
            password for security.</p>
            <p>The last step is to register the processor in the file
            <code>config/services.yaml</code>:</p>
            <div class="sourceCode" id="cb60"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># api/config/services.yaml</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>services<span class="ot">:</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">A</span>pp\<span class="cn">S</span>tate\<span class="cn">U</span>serPasswordHasher<span class="ot">:</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        bind<span class="ot">:</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>            <span class="va">$processor</span><span class="ot">:</span> <span class="st">&#39;@api_platform.doctrine.orm.state.persist_processor&#39;</span></span></code></pre></div>
            <h2 data-number="4.6" id="access-control"><span
            class="header-section-number">4.6</span> Access control</h2>
            <p>For our app we want the next roles and permissions:</p>
            <ul>
            <li>Unauthenticated users: can access to the registration
            (POST <code>/api/users</code>) and to the authentication
            (POST <code>/auth</code>) routes.</li>
            <li>Normal users (<code>ROLE_USER</code>): can access to all
            the GET routes.</li>
            <li>Admin users (<code>ROLE_ADMIN</code>): can access to all
            the operation routes.</li>
            </ul>
            <p>First, we need at least one admin user. A simple way to
            do that without doing an extensive user management system,
            is adding the next lines to the
            <code>UserPasswordHasher</code> processor:</p>
            <div class="sourceCode" id="cb61"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> process(<span class="va">$data</span><span class="ot">,</span> <span class="cn">O</span>peration <span class="va">$operation</span><span class="ot">,</span> <span class="dt">array</span> <span class="va">$uriVariables</span> <span class="op">=</span> []<span class="ot">,</span> <span class="dt">array</span> <span class="va">$context</span> <span class="op">=</span> [])</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$data</span>-&gt;eraseCredentials()<span class="ot">;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Set admin rol for the next registered user</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Comment these lines to return to normal users </span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">$roles</span>[] <span class="op">=</span> <span class="st">&#39;ROLE_ADMIN&#39;</span><span class="ot">;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">$data</span>-&gt;setRoles(<span class="va">$roles</span>)<span class="ot">;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$this</span>-&gt;processor-&gt;process(<span class="va">$data</span><span class="ot">,</span> <span class="va">$operation</span><span class="ot">,</span> <span class="va">$uriVariables</span><span class="ot">,</span> <span class="va">$context</span>)<span class="ot">;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
            <p>Don’t forget to comment the lines once you have the
            desired admin users.</p>
            <p>To register users with Postman go th the POST
            <code>/api/users</code> route and send the users data, email
            and plainPassword. You will get a response with the id of
            the new user and their email:</p>
            <figure>
            <img src="images/post_new_user.png" width="450"
            alt="Registering users" />
            <figcaption aria-hidden="true">Registering
            users</figcaption>
            </figure>
            <p>On your database now you can see the registered users and
            their roles (the <code>ROLE_USER</code> is added
            automatically every time we get a user from the database,
            see the <code>getRoles()</code> method in the
            <code>User</code> class):</p>
            <figure>
            <img src="images/users-db.png" alt="Users in the DB" />
            <figcaption aria-hidden="true">Users in the DB</figcaption>
            </figure>
            <p>Once we have users with the admin and normal roles, we
            only need to add <code>security</code> attributes to the
            related classes:</p>
            <div class="sourceCode" id="cb62"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">// /Entity/Category</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    description<span class="ot">:</span> <span class="st">&#39;Categories of meals&#39;</span><span class="ot">,</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>et()<span class="ot">,</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>etCollection()<span class="ot">,</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ost(security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span>)<span class="ot">,</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ut(security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span>)<span class="ot">,</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">D</span>elete(security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span>)<span class="ot">,</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    ]<span class="ot">,</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_USER&#39;)&quot;</span><span class="ot">,</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>)<span class="at">]</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">C</span>ategory</span></code></pre></div>
            <div class="sourceCode" id="cb63"><pre
            class="sourceCode php"><code class="sourceCode php"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">// /Entity/Dish</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span><span class="cn">A</span>piResource (</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    operations<span class="ot">:</span> [</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>et(</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>            uriTemplate<span class="ot">:</span> <span class="st">&#39;/food/{id}&#39;</span><span class="ot">,</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>            requirements<span class="ot">:</span> [<span class="st">&#39;id&#39;</span> =&gt; <span class="st">&#39;\d+&#39;</span>]<span class="ot">,</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        )<span class="ot">,</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">G</span>etCollection()<span class="ot">,</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ost(</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>            defaults<span class="ot">:</span> [<span class="st">&#39;ingredients&#39;</span> =&gt; <span class="st">&#39;Pasta&#39;</span>]<span class="ot">,</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>            security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        )<span class="ot">,</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">P</span>ut(security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span>)<span class="ot">,</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="cn">D</span>elete(security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_ADMIN&#39;)&quot;</span>)<span class="ot">,</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">]</span><span class="ot">,</span>    </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    security<span class="ot">:</span> <span class="st">&quot;is_granted(&#39;ROLE_USER&#39;)&quot;</span><span class="ot">,</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">D</span>ish</span></code></pre></div>
            <p>As you can see, we are requiring the
            <code>ROLE_USER</code> for all the operations with
            <code>security: "is_granted('ROLE_USER')"</code> for the
            whole class, and the <code>ROLE_ADMIN</code> for only the
            PUT, POST and DELETE operations
            (<code>new Post(security: "is_granted('ROLE_ADMIN')")</code>,
            etc).</p>
            <p>More information about security in API Platform: <a
            href="https://api-platform.com/docs/symfony/security/">https://api-platform.com/docs/core/security/</a></p>
            <h2 data-number="4.7" id="usage"><span
            class="header-section-number">4.7</span> Usage</h2>
            <p>The first step is to authenticate the user using its
            credentials. You can test getting the token with Postman.
            Send a POST request to the <code>/auth</code> route and a
            json string in the body with valid username and
            password:</p>
            <figure>
            <img src="images/get_token.png" width="450"
            alt="Getting token" />
            <figcaption aria-hidden="true">Getting token</figcaption>
            </figure>
            <p>Copy the value of “token”.</p>
            <p>Now, make a get request without the token. You will get
            <em>JWT Token not found</em> message.:</p>
            <figure>
            <img src="images/get_no_token.png" width="450"
            alt="Unauthenticated GET request" />
            <figcaption aria-hidden="true">Unauthenticated GET
            request</figcaption>
            </figure>
            <p>To do a successful request, we must add an
            <strong>Authorization</strong> header which value will be
            <strong>“Bearer”</strong> (with an ending space) followed by
            the token value:</p>
            <figure>
            <img src="images/get_with_token.png"
            alt="Authenticated GET request" />
            <figcaption aria-hidden="true">Authenticated GET
            request</figcaption>
            </figure>
            <p>That’s all! Try to do the rest of the requests with the
            token. The POST, PUT and DELETE operations only will work
            with an admin user, while a normal registered user can use
            only the GET operations. Remember that the token will last
            only for 1 hour.</p>
            <p>You can get all the code from the <a
            href="https://github.com/ricardoprofe/restaurant_public">GitHub
            repository</a>.</p>
            <p><a
            href="https://api-platform.com/docs/distribution/">Full API
            Platform documentation</a></p>
        </main>
        

        <!--- Modal images -->

        <!-- The Modal -->
        <div id="myModal" class="modal">

            <!-- The Close Button -->
            <!--span class="close">&times;</span-->

            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="img01">

            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>

        <!-- End Modal Images -->

        <!-- Snackbar for copy code -->
        <div id="snackbar">Codi copiat!</div>
        <!-- End Snackbar -->

        <script>
            function ModalizeImages() {
                // Script basat en https://www.w3schools.com/howto/howto_css_modal_images.asp
                // PEr ampliar imatges en fer click

                // Get the modal
                var modal = document.getElementById("myModal");

                var modalImg = document.getElementById("img01");
                var captionText = document.getElementById("caption");

                // Get the image and insert it inside the modal - use its "alt" text as a caption
                //var img = document.getElementById("myImg");
                document.querySelectorAll("img").forEach((img => {
                        img.onclick = function() {
                            modal.style.display = "block";
                            modalImg.src = this.src;
                            captionText.innerHTML = this.alt;
                        }
                    }))
                    // Get the <span> element that closes the modal
                var span = document.getElementsByClassName("close")[0];

                // When the user clicks on <span> (x), close the modal
                //span.onclick = function() {
                myModal.onclick = function() {
                    modal.style.display = "none";
                }


            }


            function markItem(id) {
                // Restaurem format de tots
                document.querySelectorAll("#TOC a").forEach(function(item) {
                        //item.style.fontWeight = "300";
                        item.classList.remove("navItemSelected");
                    })
                    //item.style.color = "#ff0000";

                // Afegim format
                let items = document.querySelectorAll("#TOC a[href='#" + id + "']");
                items.forEach(function(item) {
                    //item.style.fontWeight = "bolder";
                    item.classList.add("navItemSelected");
                })

            }

            var observer = new IntersectionObserver(function(entries) {
                // isIntersecting is true when element and viewport are overlapping
                // isIntersecting is false when element and viewport don't overlap
                if (entries[0].isIntersecting === true) {
                    let id = entries[0].target.id;
                    markItem(id);
                }

            }, {
                threshold: [0]
            });

            window.addEventListener("load", function() {
                document.querySelectorAll("h1, h2, h3").forEach(function(item) {
                    observer.observe(item);
                });

                document.querySelectorAll("#TOC a").forEach(function(item) {
                    item.addEventListener("click", function(item) {
                        markItem(item.id);
                    })
                })

                // Fem modals totes les imatges
                ModalizeImages();
            })

            document.querySelector("#TOC").addEventListener("click", function(event) {
                let toc = event.target
                if (toc.offsetWidth > 10) {
                    toc.classList.add("minimizedToc");
                }
            })

            document.querySelector("#TOC").addEventListener("mouseover", function(event) {
                let toc = event.target
                if (toc.classList.contains("minimizedToc"))
                    toc.classList.remove("minimizedToc");
            })


                        
            /* PER COPIAR CODI */


            // Busca tots els elements amb la classe "sourceCode"
            var sourceCodeElements = document.querySelectorAll('div.sourceCode');

            /*Afegim el botó a tots els divs */
            // Afegir un botó per a cada element "sourceCode"
            sourceCodeElements.forEach(function(element) {
                console.log(element.id);
                var button = document.createElement('div');
                button.className = 'button-copy';

                // Afegir una icona al botó (fa servir FontAwesome com a exemple)
                //var icon = document.createElement('i');
                //icon.className = 'fas fa-copy'; // Utilitza l'ícona "copy" de FontAwesome

                // Obté l'ID de l'element actual
                var elementId = element.id;

                // Afegeix un event listener al botó per cridar la funció amb l'ID
                button.addEventListener('click', function() {
                    copyContent(elementId);
                });

                // Afegeix l'icona al botó i el botó just dins de l'element "sourceCode"
                //button.appendChild(icon);
                element.appendChild(button);
            });



            // Funció per copiar el contingut d'un element amb l'ID donat
            function copyContent(elementId) {
                var element = document.getElementById(elementId);
                var textToCopy = element.innerText;

                // Crea un element de text i copia el contingut
                var textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);

                // Selecciona i copia el text
                textArea.select();
                document.execCommand('copy');

                // Elimina l'element de text afegit temporalment
                document.body.removeChild(textArea);

                // Notifica a l'usuari que el codi s'ha copiat
                mostraSnackbar();
            }

            /* SNACKBAR EN COPIAR CODI */

            function mostraSnackbar() {
            // Busquem l'snackbar
            var x = document.getElementById("snackbar");

            // Li afegim la classe show
            x.className = "show";

            // I als tres segons la llevem
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
            } 




        </script>
    </div>
</body>

</html>